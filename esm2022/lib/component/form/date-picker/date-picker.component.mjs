import { Component, EventEmitter, forwardRef, Input, Optional, Output, ViewChild, } from '@angular/core';
import { FormsModule, NG_VALUE_ACCESSOR, ReactiveFormsModule } from '@angular/forms';
import { BaseControlValueAccessor } from '../base-control-value-accessor';
import { OverlayPanelModule } from 'primeng/overlaypanel';
import { CalendarModule } from 'primeng/calendar';
import { DropdownModule } from 'primeng/dropdown';
import { MaLibModule } from '../../../ma-lib.module';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common";
import * as i3 from "@ngx-translate/core";
import * as i4 from "primeng/calendar";
import * as i5 from "primeng/api";
import * as i6 from "primeng/dropdown";
export class DatePickerComponent extends BaseControlValueAccessor {
    constructor(controlContainer, cdr) {
        super(controlContainer);
        this.controlContainer = controlContainer;
        this.cdr = cdr;
        this.label = '';
        this.showTime = true;
        this.dateOption = 'daily';
        this.dateOptions = [
            { label: 'daily', value: 'daily' },
            { label: 'weekly', value: 'weekly' },
            { label: 'monthly', value: 'monthly' },
        ];
        this.onChangeInterval = new EventEmitter();
    }
    get formGroup() {
        return this.controlContainer?.control;
    }
    ngOnInit() {
        this.control.valueChanges.subscribe(() => {
            this.highlightWeek();
            if (this.control.value && this.control.value.length === 2) {
                const [fromDate, toDate] = this.control.value;
                const oneYearInMillis = 365 * 24 * 60 * 60 * 1000;
                if (toDate && (toDate.getTime() - fromDate.getTime() > oneYearInMillis)) {
                    const adjustedToDate = new Date(fromDate.getTime() + oneYearInMillis);
                    this.control.setValue([fromDate, adjustedToDate], { emitEvent: false });
                }
            }
        });
    }
    onTimeChange() {
        this.control.setValue(this.control.value);
    }
    onCalendarOpen() {
        if (this.control.value) {
            this.highlightWeek();
        }
    }
    highlightWeek() {
        if (this.dateOption !== 'weekly') {
            return;
        }
        setTimeout(() => {
            const cells = document.querySelectorAll('.date-picker tr');
            cells.forEach(cell => {
                const span = cell.querySelector('span.p-highlight');
                if (span) {
                    cell.classList.add('week-highlight');
                }
            });
        }, 50);
    }
    onChangeDateOption(event) {
        let date = this.control.value;
        if (date && date.length == 2) {
            this.onSelectDate(date[0], true);
        }
        else {
            this.onSelectDate(this.control.value, true);
        }
        const currentValue = this.control.value;
        this.control.setValue(null, { emitEvent: false });
        this.control.setValue(currentValue);
        this.onChangeInterval.emit(event);
    }
    onSelectDate(selectedDate, byOption = false) {
        if (!selectedDate) {
            return;
        }
        if (this.dateOption === 'weekly') {
            const startOfWeek = this.getStartOfWeek(selectedDate);
            const endOfWeek = this.getEndOfWeek(selectedDate);
            this.control.setValue([startOfWeek, endOfWeek]);
            this.calendar.overlayVisible = false;
        }
        else if (this.dateOption === 'monthly' && byOption) {
            const startOfMonth = this.getStartOfMonth(selectedDate);
            this.control.setValue(startOfMonth, { emitEvent: false });
        }
        else if (this.dateOption === 'daily' && byOption) {
            this.control.setValue(selectedDate, { emitEvent: false });
        }
        this.cdr.detectChanges();
    }
    getStartOfMonth(date) {
        date = new Date(date);
        return new Date(date.getFullYear(), date.getMonth(), 1);
    }
    getEndOfMonth(date) {
        date = new Date(date);
        return new Date(date.getFullYear(), date.getMonth() + 1, 0);
    }
    getStartOfWeek(date) {
        const day = date.getDay();
        const diff = date.getDate() - day;
        return new Date(date.setDate(diff));
    }
    getEndOfWeek(date) {
        const startOfWeek = this.getStartOfWeek(date);
        return new Date(startOfWeek.setDate(startOfWeek.getDate() + 6));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: DatePickerComponent, deps: [{ token: i1.ControlContainer, optional: true }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: DatePickerComponent, isStandalone: true, selector: "date-picker", inputs: { label: "label", maxDate: "maxDate", minDate: "minDate", showTime: "showTime" }, outputs: { onChangeInterval: "onChangeInterval" }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => DatePickerComponent),
                multi: true,
            },
        ], viewQueries: [{ propertyName: "calendar", first: true, predicate: ["calendar"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<div class=\"combo-datepicker\">\n  <div class=\"p-inputgroup\">\n    <span class=\"p-inputgroup-addon\">\n      <p-dropdown [options]=\"dateOptions\" [(ngModel)]=\"dateOption\" [ngModelOptions]=\" \n             {standalone: true}\" (ngModelChange)=\"onChangeDateOption($event)\" [optionLabel]=\"'label'\"\n        [optionValue]=\"'value'\">\n        <ng-template let-selectedItem pTemplate=\"selectedItem\">\n          <span *ngIf=\"selectedItem\">\n            {{ selectedItem.label | translate}}\n          </span>\n          <span *ngIf=\"!selectedItem \">\n            {{ 'all' | translate }}\n          </span>\n        </ng-template>\n        <ng-template pTemplate=\"option\" let-option>{{option.label | translate}} </ng-template>\n      </p-dropdown>\n    </span>\n    <div class=\"date-picker date-picker-container \">\n      <div class=\"calendar-container\">\n        <p-calendar [formControl]=\"control\" [minDate]=\"minDate\" [maxDate]=\"maxDate\" (onFocus)=\"onCalendarOpen()\"\n          #calendar (onSelect)=\"onSelectDate($event)\" [styleClass]=\"dateOption =='weekly'?'date-picker-week' : ''\"\n          [view]=\"dateOption =='monthly'?'month': 'date'\" [selectionMode]=\"dateOption =='weekly'?'range':'single'\"\n          [dateFormat]=\"dateOption =='monthly'?'mm/yy': 'dd/mm/yy'\" [showWeek]=\"dateOption =='weekly'\"\n          [placeholder]=\"'Select Date'\"></p-calendar>\n      </div>\n    </div>\n  </div>\n</div>", styles: [".date-picker-container{display:flex}.date-picker-container ::ng-deep .p-calendar .p-datepicker{width:unset!important}.date-picker-container ::ng-deep .p-datepicker.p-datepicker-multiple-month .p-datepicker-group{border-left:unset!important}.date-picker-container ::ng-deep .p-datepicker{border:unset}.date-picker-container ::ng-deep .p-datepicker td>span{margin:0}.date-picker-container ::ng-deep .p-datepicker table th{padding:2px}.date-picker-container ::ng-deep .p-datepicker table td>span{width:34px;height:32px;border-radius:4px}.date-picker-container ::ng-deep .p-datepicker table td{padding:2px 0}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{border-radius:4px;background:#2e6be5!important;color:#fff!important}.date-picker-container ::ng-deep .p-datepicker table td.p-datepicker-today span{border-radius:4px;color:#2e6be5;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{color:#404040;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header{border-bottom:unset}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header .p-datepicker-title .p-datepicker-month{margin-right:.5rem!important}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-prev,.date-picker-container ::ng-deep .p-datepicker .p-datepicker-next{border:1px solid #E6E6E6;border-radius:4px;height:32px;width:32px}.date-picker-container .time-intervals{flex:0 0 136px;border-right:1px solid #e6e6e6;padding-right:8px}.date-picker-container .time-intervals ul{list-style:none;padding:0;margin:0}.date-picker-container .time-intervals ul li{cursor:pointer;padding:14px 0;font-size:14px;color:#333;font-weight:400}.date-picker-container .time-intervals ul li:hover,.date-picker-container .time-intervals ul li.active{font-weight:600}.date-picker-container .calendar-container{flex:1}.date-range-actions{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem;border-top:1px solid #E6E6E6;padding-top:16px;align-items:center}.date-range-actions button{min-width:80px}.date-range-actions .date-range-value{color:#6c6c6c;padding-right:16px}.button-custom-date-range{padding:0;border:unset!important;box-shadow:unset!important;background:#fff!important;max-width:20vw;text-align:left;display:block}.value-range{color:#404040;font-weight:400;line-height:20px;padding-top:5px;font-size:14px;display:block}.p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker{padding-right:16px}::ng-deep .combo-datepicker .p-datepicker-weekheader{padding-right:24px!important}::ng-deep .combo-datepicker .p-datepicker-weeknumber{padding-right:24px!important}::ng-deep .combo-datepicker .p-inputgroup .p-inputwrapper>.p-component{width:unset}::ng-deep .combo-datepicker .p-dropdown{border:unset;border-radius:unset;border-top-left-radius:6px;border-bottom-left-radius:6px}::ng-deep .combo-datepicker .p-dropdown-label{max-width:10vw}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext{border-radius:0 6px 6px 0}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext:has(+.p-inputgroup-addon .circle-x){border-right:unset}::ng-deep .combo-datepicker .p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.pi-search){padding-left:12px;min-width:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.circle-x){border-left:unset}::ng-deep .combo-datepicker .p-inputtext:enabled:focus{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-inputtext:enabled:hover{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-dropdown:not(.p-disabled).p-focus{box-shadow:unset;border-color:#d1d5db}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month{padding:10px}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month.p-highlight{background:#2e6be5!important;color:#fff!important}::ng-deep .date-picker-week .week-highlight td{background-color:#2e6be5!important;color:#fff!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week .week-highlight td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week .week-highlight td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td{background-color:#f5f5f5!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week .p-datepicker:not(.p-disabled) table td span:not(.p-highlight):not(.p-disabled):hover{background-color:unset!important}::ng-deep .date-picker-week .p-datepicker table td span.p-highlight{background-color:unset!important}\n"], dependencies: [{ kind: "ngmodule", type: MaLibModule }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i3.TranslatePipe, name: "translate" }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "ngmodule", type: CalendarModule }, { kind: "component", type: i4.Calendar, selector: "p-calendar", inputs: ["style", "styleClass", "inputStyle", "inputId", "name", "inputStyleClass", "placeholder", "ariaLabelledBy", "iconAriaLabel", "disabled", "dateFormat", "multipleSeparator", "rangeSeparator", "inline", "showOtherMonths", "selectOtherMonths", "showIcon", "icon", "appendTo", "readonlyInput", "shortYearCutoff", "monthNavigator", "yearNavigator", "hourFormat", "timeOnly", "stepHour", "stepMinute", "stepSecond", "showSeconds", "required", "showOnFocus", "showWeek", "showClear", "dataType", "selectionMode", "maxDateCount", "showButtonBar", "todayButtonStyleClass", "clearButtonStyleClass", "autoZIndex", "baseZIndex", "panelStyleClass", "panelStyle", "keepInvalid", "hideOnDateTimeSelect", "touchUI", "timeSeparator", "focusTrap", "showTransitionOptions", "hideTransitionOptions", "tabindex", "minDate", "maxDate", "disabledDates", "disabledDays", "yearRange", "showTime", "responsiveOptions", "numberOfMonths", "firstDayOfWeek", "locale", "view", "defaultDate"], outputs: ["onFocus", "onBlur", "onClose", "onSelect", "onClear", "onInput", "onTodayClick", "onClearClick", "onMonthChange", "onYearChange", "onClickOutside", "onShow"] }, { kind: "directive", type: i5.PrimeTemplate, selector: "[pTemplate]", inputs: ["type", "pTemplate"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i1.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "ngmodule", type: OverlayPanelModule }, { kind: "ngmodule", type: DropdownModule }, { kind: "component", type: i6.Dropdown, selector: "p-dropdown", inputs: ["scrollHeight", "filter", "name", "style", "panelStyle", "styleClass", "panelStyleClass", "readonly", "required", "editable", "appendTo", "tabindex", "placeholder", "filterPlaceholder", "filterLocale", "inputId", "selectId", "dataKey", "filterBy", "autofocus", "resetFilterOnHide", "dropdownIcon", "optionLabel", "optionValue", "optionDisabled", "optionGroupLabel", "optionGroupChildren", "autoDisplayFirst", "group", "showClear", "emptyFilterMessage", "emptyMessage", "lazy", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "overlayOptions", "ariaFilterLabel", "ariaLabel", "ariaLabelledBy", "filterMatchMode", "maxlength", "tooltip", "tooltipPosition", "tooltipPositionStyle", "tooltipStyleClass", "autofocusFilter", "overlayDirection", "disabled", "itemSize", "autoZIndex", "baseZIndex", "showTransitionOptions", "hideTransitionOptions", "filterValue", "options"], outputs: ["onChange", "onFilter", "onFocus", "onBlur", "onClick", "onShow", "onHide", "onClear", "onLazyLoad"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: DatePickerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'date-picker', standalone: true, imports: [
                        MaLibModule,
                        ReactiveFormsModule,
                        CalendarModule,
                        FormsModule,
                        OverlayPanelModule,
                        DropdownModule
                    ], providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => DatePickerComponent),
                            multi: true,
                        },
                    ], template: "<div class=\"combo-datepicker\">\n  <div class=\"p-inputgroup\">\n    <span class=\"p-inputgroup-addon\">\n      <p-dropdown [options]=\"dateOptions\" [(ngModel)]=\"dateOption\" [ngModelOptions]=\" \n             {standalone: true}\" (ngModelChange)=\"onChangeDateOption($event)\" [optionLabel]=\"'label'\"\n        [optionValue]=\"'value'\">\n        <ng-template let-selectedItem pTemplate=\"selectedItem\">\n          <span *ngIf=\"selectedItem\">\n            {{ selectedItem.label | translate}}\n          </span>\n          <span *ngIf=\"!selectedItem \">\n            {{ 'all' | translate }}\n          </span>\n        </ng-template>\n        <ng-template pTemplate=\"option\" let-option>{{option.label | translate}} </ng-template>\n      </p-dropdown>\n    </span>\n    <div class=\"date-picker date-picker-container \">\n      <div class=\"calendar-container\">\n        <p-calendar [formControl]=\"control\" [minDate]=\"minDate\" [maxDate]=\"maxDate\" (onFocus)=\"onCalendarOpen()\"\n          #calendar (onSelect)=\"onSelectDate($event)\" [styleClass]=\"dateOption =='weekly'?'date-picker-week' : ''\"\n          [view]=\"dateOption =='monthly'?'month': 'date'\" [selectionMode]=\"dateOption =='weekly'?'range':'single'\"\n          [dateFormat]=\"dateOption =='monthly'?'mm/yy': 'dd/mm/yy'\" [showWeek]=\"dateOption =='weekly'\"\n          [placeholder]=\"'Select Date'\"></p-calendar>\n      </div>\n    </div>\n  </div>\n</div>", styles: [".date-picker-container{display:flex}.date-picker-container ::ng-deep .p-calendar .p-datepicker{width:unset!important}.date-picker-container ::ng-deep .p-datepicker.p-datepicker-multiple-month .p-datepicker-group{border-left:unset!important}.date-picker-container ::ng-deep .p-datepicker{border:unset}.date-picker-container ::ng-deep .p-datepicker td>span{margin:0}.date-picker-container ::ng-deep .p-datepicker table th{padding:2px}.date-picker-container ::ng-deep .p-datepicker table td>span{width:34px;height:32px;border-radius:4px}.date-picker-container ::ng-deep .p-datepicker table td{padding:2px 0}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{border-radius:4px;background:#2e6be5!important;color:#fff!important}.date-picker-container ::ng-deep .p-datepicker table td.p-datepicker-today span{border-radius:4px;color:#2e6be5;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{color:#404040;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header{border-bottom:unset}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header .p-datepicker-title .p-datepicker-month{margin-right:.5rem!important}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-prev,.date-picker-container ::ng-deep .p-datepicker .p-datepicker-next{border:1px solid #E6E6E6;border-radius:4px;height:32px;width:32px}.date-picker-container .time-intervals{flex:0 0 136px;border-right:1px solid #e6e6e6;padding-right:8px}.date-picker-container .time-intervals ul{list-style:none;padding:0;margin:0}.date-picker-container .time-intervals ul li{cursor:pointer;padding:14px 0;font-size:14px;color:#333;font-weight:400}.date-picker-container .time-intervals ul li:hover,.date-picker-container .time-intervals ul li.active{font-weight:600}.date-picker-container .calendar-container{flex:1}.date-range-actions{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem;border-top:1px solid #E6E6E6;padding-top:16px;align-items:center}.date-range-actions button{min-width:80px}.date-range-actions .date-range-value{color:#6c6c6c;padding-right:16px}.button-custom-date-range{padding:0;border:unset!important;box-shadow:unset!important;background:#fff!important;max-width:20vw;text-align:left;display:block}.value-range{color:#404040;font-weight:400;line-height:20px;padding-top:5px;font-size:14px;display:block}.p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker{padding-right:16px}::ng-deep .combo-datepicker .p-datepicker-weekheader{padding-right:24px!important}::ng-deep .combo-datepicker .p-datepicker-weeknumber{padding-right:24px!important}::ng-deep .combo-datepicker .p-inputgroup .p-inputwrapper>.p-component{width:unset}::ng-deep .combo-datepicker .p-dropdown{border:unset;border-radius:unset;border-top-left-radius:6px;border-bottom-left-radius:6px}::ng-deep .combo-datepicker .p-dropdown-label{max-width:10vw}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext{border-radius:0 6px 6px 0}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext:has(+.p-inputgroup-addon .circle-x){border-right:unset}::ng-deep .combo-datepicker .p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.pi-search){padding-left:12px;min-width:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.circle-x){border-left:unset}::ng-deep .combo-datepicker .p-inputtext:enabled:focus{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-inputtext:enabled:hover{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-dropdown:not(.p-disabled).p-focus{box-shadow:unset;border-color:#d1d5db}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month{padding:10px}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month.p-highlight{background:#2e6be5!important;color:#fff!important}::ng-deep .date-picker-week .week-highlight td{background-color:#2e6be5!important;color:#fff!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week .week-highlight td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week .week-highlight td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td{background-color:#f5f5f5!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week .p-datepicker:not(.p-disabled) table td span:not(.p-highlight):not(.p-disabled):hover{background-color:unset!important}::ng-deep .date-picker-week .p-datepicker table td span.p-highlight{background-color:unset!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ControlContainer, decorators: [{
                    type: Optional
                }] }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { label: [{
                type: Input
            }], maxDate: [{
                type: Input
            }], minDate: [{
                type: Input
            }], showTime: [{
                type: Input
            }], calendar: [{
                type: ViewChild,
                args: ['calendar']
            }], onChangeInterval: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWEtbGliL3NyYy9saWIvY29tcG9uZW50L2Zvcm0vZGF0ZS1waWNrZXIvZGF0ZS1waWNrZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWEtbGliL3NyYy9saWIvY29tcG9uZW50L2Zvcm0vZGF0ZS1waWNrZXIvZGF0ZS1waWNrZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUNWLEtBQUssRUFFTCxRQUFRLEVBQ1IsTUFBTSxFQUNOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQStCLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xILE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzFFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzFELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHdCQUF3QixDQUFDOzs7Ozs7OztBQXVCckQsTUFBTSxPQUFPLG1CQUFvQixTQUFRLHdCQUF3QjtJQW1CL0QsWUFBd0MsZ0JBQWtDLEVBQ2hFLEdBQXNCO1FBRTlCLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBSGMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNoRSxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQW5CdkIsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUluQixhQUFRLEdBQVksSUFBSSxD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Z0JBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsbUJBQW1CLENBQUM7Z0JBQ2xELEtBQUssRUFBRSxJQUFJO2FBQ1o7U0FDRix1SkNyQ0gsbzZDQTJCTSxxK0pESkYsV0FBVywrTEFDWCxtQkFBbUIseVRBQ25CLGNBQWMsNHpDQUNkLFdBQVcsc1BBQ1gsa0JBQWtCLDhCQUNsQixjQUFjOzs0RkFXTCxtQkFBbUI7a0JBckIvQixTQUFTOytCQUNFLGFBQWEsY0FFWCxJQUFJLFdBQ1A7d0JBQ1AsV0FBVzt3QkFDWCxtQkFBbUI7d0JBQ25CLGNBQWM7d0JBQ2QsV0FBVzt3QkFDWCxrQkFBa0I7d0JBQ2xCLGNBQWM7cUJBQ2YsYUFFVTt3QkFDVDs0QkFDRSxPQUFPLEVBQUUsaUJBQWlCOzRCQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxvQkFBb0IsQ0FBQzs0QkFDbEQsS0FBSyxFQUFFLElBQUk7eUJBQ1o7cUJBQ0Y7OzBCQXFCWSxRQUFROzRFQWxCWixLQUFLO3NCQUFiLEtBQUs7Z0JBRUcsT0FBTztzQkFBZixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQVN5QixRQUFRO3NCQUF0QyxTQUFTO3VCQUFDLFVBQVU7Z0JBRVgsZ0JBQWdCO3NCQUF6QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBmb3J3YXJkUmVmLFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPcHRpb25hbCxcbiAgT3V0cHV0LFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udHJvbENvbnRhaW5lciwgRm9ybUdyb3VwLCBGb3Jtc01vZHVsZSwgTkdfVkFMVUVfQUNDRVNTT1IsIFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBCYXNlQ29udHJvbFZhbHVlQWNjZXNzb3IgfSBmcm9tICcuLi9iYXNlLWNvbnRyb2wtdmFsdWUtYWNjZXNzb3InO1xuaW1wb3J0IHsgT3ZlcmxheVBhbmVsTW9kdWxlIH0gZnJvbSAncHJpbWVuZy9vdmVybGF5cGFuZWwnO1xuaW1wb3J0IHsgQ2FsZW5kYXJNb2R1bGUgfSBmcm9tICdwcmltZW5nL2NhbGVuZGFyJztcbmltcG9ydCB7IERyb3Bkb3duTW9kdWxlIH0gZnJvbSAncHJpbWVuZy9kcm9wZG93bic7XG5pbXBvcnQgeyBNYUxpYk1vZHVsZSB9IGZyb20gJy4uLy4uLy4uL21hLWxpYi5tb2R1bGUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdkYXRlLXBpY2tlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9kYXRlLXBpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBNYUxpYk1vZHVsZSxcbiAgICBSZWFjdGl2ZUZvcm1zTW9kdWxlLFxuICAgIENhbGVuZGFyTW9kdWxlLFxuICAgIEZvcm1zTW9kdWxlLFxuICAgIE92ZXJsYXlQYW5lbE1vZHVsZSxcbiAgICBEcm9wZG93bk1vZHVsZVxuICBdLFxuICBzdHlsZVVybHM6IFsnZGF0ZS1waWNrZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBEYXRlUGlja2VyQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgIH0sXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIERhdGVQaWNrZXJDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29udHJvbFZhbHVlQWNjZXNzb3IgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKSBsYWJlbDogc3RyaW5nID0gJyc7XG5cbiAgQElucHV0KCkgbWF4RGF0ZTogRGF0ZTtcbiAgQElucHV0KCkgbWluRGF0ZTogRGF0ZTtcbiAgQElucHV0KCkgc2hvd1RpbWU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIGRhdGVPcHRpb24gPSAnZGFpbHknO1xuICBkYXRlT3B0aW9uczogYW55ID0gW1xuICAgIHsgbGFiZWw6ICdkYWlseScsIHZhbHVlOiAnZGFpbHknIH0sXG4gICAgeyBsYWJlbDogJ3dlZWtseScsIHZhbHVlOiAnd2Vla2x5JyB9LFxuICAgIHsgbGFiZWw6ICdtb250aGx5JywgdmFsdWU6ICdtb250aGx5JyB9LFxuICBdXG5cbiAgQFZpZXdDaGlsZCgnY2FsZW5kYXInKSBwcml2YXRlIGNhbGVuZGFyOiBhbnk7XG5cbiAgQE91dHB1dCgpIG9uQ2hhbmdlSW50ZXJ2YWwgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cblxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwdWJsaWMgb3ZlcnJpZGUgY29udHJvbENvbnRhaW5lcjogQ29udHJvbENvbnRhaW5lcixcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgKSB7XG4gICAgc3VwZXIoY29udHJvbENvbnRhaW5lcik7XG4gIH1cblxuICBnZXQgZm9ybUdyb3VwKCk6IEZvcm1Hcm91cCB7XG4gICAgcmV0dXJuIHRoaXMuY29udHJvbENvbnRhaW5lcj8uY29udHJvbCBhcyBGb3JtR3JvdXA7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmNvbnRyb2wudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmhpZ2hsaWdodFdlZWsoKTtcbiAgICAgIGlmICh0aGlzLmNvbnRyb2wudmFsdWUgJiYgdGhpcy5jb250cm9sLnZhbHVlLmxlbmd0aCA9PT0gMikge1xuICAgICAgICBjb25zdCBbZnJvbURhdGUsIHRvRGF0ZV0gPSB0aGlzLmNvbnRyb2wudmFsdWU7XG4gICAgICAgIGNvbnN0IG9uZVllYXJJbk1pbGxpcyA9IDM2NSAqIDI0ICogNjAgKiA2MCAqIDEwMDA7XG4gICAgICAgIGlmICh0b0RhdGUgJiYgKHRvRGF0ZS5nZXRUaW1lKCkgLSBmcm9tRGF0ZS5nZXRUaW1lKCkgPiBvbmVZZWFySW5NaWxsaXMpKSB7XG4gICAgICAgICAgY29uc3QgYWRqdXN0ZWRUb0RhdGUgPSBuZXcgRGF0ZShmcm9tRGF0ZS5nZXRUaW1lKCkgKyBvbmVZZWFySW5NaWxsaXMpO1xuICAgICAgICAgIHRoaXMuY29udHJvbC5zZXRWYWx1ZShbZnJvbURhdGUsIGFkanVzdGVkVG9EYXRlXSwgeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgb25UaW1lQ2hhbmdlKCkge1xuICAgIHRoaXMuY29udHJvbC5zZXRWYWx1ZSh0aGlzLmNvbnRyb2wudmFsdWUpO1xuICB9XG4gIG9uQ2FsZW5kYXJPcGVuKCkge1xuICAgIGlmICh0aGlzLmNvbnRyb2wudmFsdWUpIHtcbiAgICAgIHRoaXMuaGlnaGxpZ2h0V2VlaygpO1xuICAgIH1cbiAgfVxuICBoaWdobGlnaHRXZWVrKCkge1xuICAgIGlmICh0aGlzLmRhdGVPcHRpb24gIT09ICd3ZWVrbHknKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgY2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGF0ZS1waWNrZXIgdHInKTtcbiAgICAgIGNlbGxzLmZvckVhY2goY2VsbCA9PiB7XG4gICAgICAgIGNvbnN0IHNwYW4gPSBjZWxsLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4ucC1oaWdobGlnaHQnKTtcbiAgICAgICAgaWYgKHNwYW4pIHtcbiAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ3dlZWstaGlnaGxpZ2h0Jyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sIDUwKTtcbiAgfVxuICBvbkNoYW5nZURhdGVPcHRpb24oZXZlbnQ6IGFueSkge1xuICAgIGxldCBkYXRlID0gdGhpcy5jb250cm9sLnZhbHVlXG5cbiAgICBpZiAoZGF0ZSAmJiBkYXRlLmxlbmd0aCA9PSAyKSB7XG4gICAgICB0aGlzLm9uU2VsZWN0RGF0ZShkYXRlWzBdLCB0cnVlKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9uU2VsZWN0RGF0ZSh0aGlzLmNvbnRyb2wudmFsdWUsIHRydWUpXG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IHRoaXMuY29udHJvbC52YWx1ZTtcbiAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUobnVsbCwgeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgIHRoaXMuY29udHJvbC5zZXRWYWx1ZShjdXJyZW50VmFsdWUpO1xuICAgIHRoaXMub25DaGFuZ2VJbnRlcnZhbC5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIG9uU2VsZWN0RGF0ZShzZWxlY3RlZERhdGU6IGFueSwgYnlPcHRpb24gPSBmYWxzZSk6IHZvaWQge1xuICAgIGlmICghc2VsZWN0ZWREYXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmRhdGVPcHRpb24gPT09ICd3ZWVrbHknKSB7XG4gICAgICBjb25zdCBzdGFydE9mV2VlayA9IHRoaXMuZ2V0U3RhcnRPZldlZWsoc2VsZWN0ZWREYXRlKTtcbiAgICAgIGNvbnN0IGVuZE9mV2VlayA9IHRoaXMuZ2V0RW5kT2ZXZWVrKHNlbGVjdGVkRGF0ZSk7XG4gICAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUoW3N0YXJ0T2ZXZWVrLCBlbmRPZldlZWtdKTtcbiAgICAgIHRoaXMuY2FsZW5kYXIub3ZlcmxheVZpc2libGUgPSBmYWxzZTtcblxuICAgIH0gZWxzZSBpZiAodGhpcy5kYXRlT3B0aW9uID09PSAnbW9udGhseScgJiYgYnlPcHRpb24pIHtcbiAgICAgIGNvbnN0IHN0YXJ0T2ZNb250aCA9IHRoaXMuZ2V0U3RhcnRPZk1vbnRoKHNlbGVjdGVkRGF0ZSk7XG4gICAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUoc3RhcnRPZk1vbnRoLCB7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmRhdGVPcHRpb24gPT09ICdkYWlseScgJiYgYnlPcHRpb24pIHtcbiAgICAgIHRoaXMuY29udHJvbC5zZXRWYWx1ZShzZWxlY3RlZERhdGUsIHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBnZXRTdGFydE9mTW9udGgoZGF0ZTogRGF0ZSk6IERhdGUge1xuICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcbiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCksIDEpO1xuICB9XG5cbiAgZ2V0RW5kT2ZNb250aChkYXRlOiBEYXRlKTogRGF0ZSB7XG4gICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xuICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSArIDEsIDApO1xuICB9XG5cbiAgZ2V0U3RhcnRPZldlZWsoZGF0ZTogRGF0ZSk6IERhdGUge1xuICAgIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF5KCk7XG4gICAgY29uc3QgZGlmZiA9IGRhdGUuZ2V0RGF0ZSgpIC0gZGF5O1xuICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLnNldERhdGUoZGlmZikpO1xuICB9XG5cbiAgZ2V0RW5kT2ZXZWVrKGRhdGU6IERhdGUpOiBEYXRlIHtcbiAgICBjb25zdCBzdGFydE9mV2VlayA9IHRoaXMuZ2V0U3RhcnRPZldlZWsoZGF0ZSk7XG4gICAgcmV0dXJuIG5ldyBEYXRlKHN0YXJ0T2ZXZWVrLnNldERhdGUoc3RhcnRPZldlZWsuZ2V0RGF0ZSgpICsgNikpO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY29tYm8tZGF0ZXBpY2tlclwiPlxuICA8ZGl2IGNsYXNzPVwicC1pbnB1dGdyb3VwXCI+XG4gICAgPHNwYW4gY2xhc3M9XCJwLWlucHV0Z3JvdXAtYWRkb25cIj5cbiAgICAgIDxwLWRyb3Bkb3duIFtvcHRpb25zXT1cImRhdGVPcHRpb25zXCIgWyhuZ01vZGVsKV09XCJkYXRlT3B0aW9uXCIgW25nTW9kZWxPcHRpb25zXT1cIiBcbiAgICAgICAgICAgICB7c3RhbmRhbG9uZTogdHJ1ZX1cIiAobmdNb2RlbENoYW5nZSk9XCJvbkNoYW5nZURhdGVPcHRpb24oJGV2ZW50KVwiIFtvcHRpb25MYWJlbF09XCInbGFiZWwnXCJcbiAgICAgICAgW29wdGlvblZhbHVlXT1cIid2YWx1ZSdcIj5cbiAgICAgICAgPG5nLXRlbXBsYXRlIGxldC1zZWxlY3RlZEl0ZW0gcFRlbXBsYXRlPVwic2VsZWN0ZWRJdGVtXCI+XG4gICAgICAgICAgPHNwYW4gKm5nSWY9XCJzZWxlY3RlZEl0ZW1cIj5cbiAgICAgICAgICAgIHt7IHNlbGVjdGVkSXRlbS5sYWJlbCB8IHRyYW5zbGF0ZX19XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDxzcGFuICpuZ0lmPVwiIXNlbGVjdGVkSXRlbSBcIj5cbiAgICAgICAgICAgIHt7ICdhbGwnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwib3B0aW9uXCIgbGV0LW9wdGlvbj57e29wdGlvbi5sYWJlbCB8IHRyYW5zbGF0ZX19IDwvbmctdGVtcGxhdGU+XG4gICAgICA8L3AtZHJvcGRvd24+XG4gICAgPC9zcGFuPlxuICAgIDxkaXYgY2xhc3M9XCJkYXRlLXBpY2tlciBkYXRlLXBpY2tlci1jb250YWluZXIgXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY2FsZW5kYXItY29udGFpbmVyXCI+XG4gICAgICAgIDxwLWNhbGVuZGFyIFtmb3JtQ29udHJvbF09XCJjb250cm9sXCIgW21pbkRhdGVdPVwibWluRGF0ZVwiIFttYXhEYXRlXT1cIm1heERhdGVcIiAob25Gb2N1cyk9XCJvbkNhbGVuZGFyT3BlbigpXCJcbiAgICAgICAgICAjY2FsZW5kYXIgKG9uU2VsZWN0KT1cIm9uU2VsZWN0RGF0ZSgkZXZlbnQpXCIgW3N0eWxlQ2xhc3NdPVwiZGF0ZU9wdGlvbiA9PSd3ZWVrbHknPydkYXRlLXBpY2tlci13ZWVrJyA6ICcnXCJcbiAgICAgICAgICBbdmlld109XCJkYXRlT3B0aW9uID09J21vbnRobHknPydtb250aCc6ICdkYXRlJ1wiIFtzZWxlY3Rpb25Nb2RlXT1cImRhdGVPcHRpb24gPT0nd2Vla2x5Jz8ncmFuZ2UnOidzaW5nbGUnXCJcbiAgICAgICAgICBbZGF0ZUZvcm1hdF09XCJkYXRlT3B0aW9uID09J21vbnRobHknPydtbS95eSc6ICdkZC9tbS95eSdcIiBbc2hvd1dlZWtdPVwiZGF0ZU9wdGlvbiA9PSd3ZWVrbHknXCJcbiAgICAgICAgICBbcGxhY2Vob2xkZXJdPVwiJ1NlbGVjdCBEYXRlJ1wiPjwvcC1jYWxlbmRhcj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PiJdfQ==