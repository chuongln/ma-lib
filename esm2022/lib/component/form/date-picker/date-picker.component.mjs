import { Component, forwardRef, Input, Optional, ViewChild, } from '@angular/core';
import { FormsModule, NG_VALUE_ACCESSOR, ReactiveFormsModule } from '@angular/forms';
import { BaseControlValueAccessor } from '../base-control-value-accessor';
import { OverlayPanelModule } from 'primeng/overlaypanel';
import { CalendarModule } from 'primeng/calendar';
import { DropdownModule } from 'primeng/dropdown';
import { MaLibModule } from '../../../ma-lib.module';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common";
import * as i3 from "@ngx-translate/core";
import * as i4 from "primeng/calendar";
import * as i5 from "primeng/api";
import * as i6 from "primeng/dropdown";
export class DatePickerComponent extends BaseControlValueAccessor {
    constructor(controlContainer, cdr) {
        super(controlContainer);
        this.controlContainer = controlContainer;
        this.cdr = cdr;
        this.label = '';
        this.showTime = true;
        this.dateOption = 'daily';
        this.dateOptions = [
            { label: 'daily', value: 'daily' },
            { label: 'weekly', value: 'weekly' },
            { label: 'monthly', value: 'monthly' },
        ];
    }
    get formGroup() {
        return this.controlContainer?.control;
    }
    ngOnInit() {
        this.control.valueChanges.subscribe(() => {
            this.highlightWeek();
            if (this.control.value && this.control.value.length === 2) {
                const [fromDate, toDate] = this.control.value;
                const oneYearInMillis = 365 * 24 * 60 * 60 * 1000;
                if (toDate && (toDate.getTime() - fromDate.getTime() > oneYearInMillis)) {
                    const adjustedToDate = new Date(fromDate.getTime() + oneYearInMillis);
                    this.control.setValue([fromDate, adjustedToDate], { emitEvent: false });
                }
            }
        });
    }
    onTimeChange() {
        this.control.setValue(this.control.value);
    }
    onCalendarOpen() {
        if (this.control.value) {
            this.highlightWeek();
        }
    }
    highlightWeek() {
        if (this.dateOption !== 'weekly') {
            return;
        }
        setTimeout(() => {
            const cells = document.querySelectorAll('.date-picker tr');
            cells.forEach(cell => {
                const span = cell.querySelector('span.p-highlight');
                if (span) {
                    cell.classList.add('week-highlight');
                }
            });
        }, 50);
    }
    onChangeDateOption(event) {
        let date = this.control.value;
        if (date && date.length == 2) {
            this.onSelectDate(date[0], true);
        }
        else {
            this.onSelectDate(this.control.value, true);
        }
        const currentValue = this.control.value;
        this.control.setValue(null, { emitEvent: false });
        this.control.setValue(currentValue);
    }
    onSelectDate(selectedDate, byOption = false) {
        if (!selectedDate) {
            return;
        }
        if (this.dateOption === 'weekly') {
            const startOfWeek = this.getStartOfWeek(selectedDate);
            const endOfWeek = this.getEndOfWeek(selectedDate);
            this.control.setValue([startOfWeek, endOfWeek]);
            this.calendar.overlayVisible = false;
        }
        else if (this.dateOption === 'monthly' && byOption) {
            const startOfMonth = this.getStartOfMonth(selectedDate);
            this.control.setValue(startOfMonth, { emitEvent: false });
        }
        else if (this.dateOption === 'daily' && byOption) {
            this.control.setValue(selectedDate, { emitEvent: false });
        }
        this.cdr.detectChanges();
    }
    getStartOfMonth(date) {
        console.log(date);
        date = new Date(date);
        return new Date(date.getFullYear(), date.getMonth(), 1);
    }
    getEndOfMonth(date) {
        date = new Date(date);
        return new Date(date.getFullYear(), date.getMonth() + 1, 0);
    }
    getStartOfWeek(date) {
        const day = date.getDay();
        const diff = date.getDate() - day;
        return new Date(date.setDate(diff));
    }
    getEndOfWeek(date) {
        const startOfWeek = this.getStartOfWeek(date);
        return new Date(startOfWeek.setDate(startOfWeek.getDate() + 6));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: DatePickerComponent, deps: [{ token: i1.ControlContainer, optional: true }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: DatePickerComponent, isStandalone: true, selector: "date-picker", inputs: { label: "label", maxDate: "maxDate", minDate: "minDate", showTime: "showTime" }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => DatePickerComponent),
                multi: true,
            },
        ], viewQueries: [{ propertyName: "calendar", first: true, predicate: ["calendar"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<div class=\"combo-datepicker\">\n  <div class=\"p-inputgroup\">\n    <span class=\"p-inputgroup-addon\">\n      <p-dropdown [options]=\"dateOptions\" [(ngModel)]=\"dateOption\" [ngModelOptions]=\" \n             {standalone: true}\" (ngModelChange)=\"onChangeDateOption($event)\" [optionLabel]=\"'label'\"\n        [optionValue]=\"'value'\">\n        <ng-template let-selectedItem pTemplate=\"selectedItem\">\n          <span *ngIf=\"selectedItem\">\n            {{ selectedItem.label | translate}}\n          </span>\n          <span *ngIf=\"!selectedItem \">\n            {{ 'all' | translate }}\n          </span>\n        </ng-template>\n        <ng-template pTemplate=\"option\" let-option>{{option.label | translate}} </ng-template>\n      </p-dropdown>\n    </span>\n    <div class=\"date-picker date-picker-container \">\n      <div class=\"calendar-container\">\n        <p-calendar [formControl]=\"control\" [minDate]=\"minDate\" [maxDate]=\"maxDate\" (onFocus)=\"onCalendarOpen()\"\n          #calendar (onSelect)=\"onSelectDate($event)\" [styleClass]=\"dateOption =='weekly'?'date-picker-week' : ''\"\n          [view]=\"dateOption =='monthly'?'month': 'date'\" [selectionMode]=\"dateOption =='weekly'?'range':'single'\"\n          [dateFormat]=\"dateOption =='monthly'?'mm/yy': 'dd/mm/yy'\" [showWeek]=\"dateOption =='weekly'\"\n          [placeholder]=\"'Select Date'\"></p-calendar>\n      </div>\n    </div>\n  </div>\n</div>", styles: [".date-picker-container{display:flex}.date-picker-container ::ng-deep .p-calendar .p-datepicker{width:unset!important}.date-picker-container ::ng-deep .p-datepicker.p-datepicker-multiple-month .p-datepicker-group{border-left:unset!important}.date-picker-container ::ng-deep .p-datepicker{border:unset}.date-picker-container ::ng-deep .p-datepicker td>span{margin:0}.date-picker-container ::ng-deep .p-datepicker table th{padding:2px}.date-picker-container ::ng-deep .p-datepicker table td>span{width:34px;height:32px;border-radius:4px}.date-picker-container ::ng-deep .p-datepicker table td{padding:2px 0}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{border-radius:4px;background:#2e6be5!important;color:#fff!important}.date-picker-container ::ng-deep .p-datepicker table td.p-datepicker-today span{border-radius:4px;color:#2e6be5;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{color:#404040;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header{border-bottom:unset}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header .p-datepicker-title .p-datepicker-month{margin-right:.5rem!important}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-prev,.date-picker-container ::ng-deep .p-datepicker .p-datepicker-next{border:1px solid #E6E6E6;border-radius:4px;height:32px;width:32px}.date-picker-container .time-intervals{flex:0 0 136px;border-right:1px solid #e6e6e6;padding-right:8px}.date-picker-container .time-intervals ul{list-style:none;padding:0;margin:0}.date-picker-container .time-intervals ul li{cursor:pointer;padding:14px 0;font-size:14px;color:#333;font-weight:400}.date-picker-container .time-intervals ul li:hover,.date-picker-container .time-intervals ul li.active{font-weight:600}.date-picker-container .calendar-container{flex:1}.date-range-actions{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem;border-top:1px solid #E6E6E6;padding-top:16px;align-items:center}.date-range-actions button{min-width:80px}.date-range-actions .date-range-value{color:#6c6c6c;padding-right:16px}.button-custom-date-range{padding:0;border:unset!important;box-shadow:unset!important;background:#fff!important;max-width:20vw;text-align:left;display:block}.value-range{color:#404040;font-weight:400;line-height:20px;padding-top:5px;font-size:14px;display:block}.p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker{padding-right:16px}::ng-deep .combo-datepicker .p-datepicker-weekheader{padding-right:24px!important}::ng-deep .combo-datepicker .p-datepicker-weeknumber{padding-right:24px!important}::ng-deep .combo-datepicker .p-inputgroup .p-inputwrapper>.p-component{width:unset}::ng-deep .combo-datepicker .p-dropdown{border:unset;border-radius:unset;border-top-left-radius:6px;border-bottom-left-radius:6px}::ng-deep .combo-datepicker .p-dropdown-label{max-width:10vw}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext{border-radius:0 6px 6px 0}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext:has(+.p-inputgroup-addon .circle-x){border-right:unset}::ng-deep .combo-datepicker .p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.pi-search){padding-left:12px;min-width:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.circle-x){border-left:unset}::ng-deep .combo-datepicker .p-inputtext:enabled:focus{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-inputtext:enabled:hover{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-dropdown:not(.p-disabled).p-focus{box-shadow:unset;border-color:#d1d5db}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month{padding:10px}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month.p-highlight{background:#2e6be5!important;color:#fff!important}::ng-deep .date-picker-week .week-highlight td{background-color:#2e6be5!important;color:#fff!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week .week-highlight td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week .week-highlight td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td{background-color:#f5f5f5!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week .p-datepicker:not(.p-disabled) table td span:not(.p-highlight):not(.p-disabled):hover{background-color:unset!important}::ng-deep .date-picker-week .p-datepicker table td span.p-highlight{background-color:unset!important}\n"], dependencies: [{ kind: "ngmodule", type: MaLibModule }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i3.TranslatePipe, name: "translate" }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "ngmodule", type: CalendarModule }, { kind: "component", type: i4.Calendar, selector: "p-calendar", inputs: ["style", "styleClass", "inputStyle", "inputId", "name", "inputStyleClass", "placeholder", "ariaLabelledBy", "iconAriaLabel", "disabled", "dateFormat", "multipleSeparator", "rangeSeparator", "inline", "showOtherMonths", "selectOtherMonths", "showIcon", "icon", "appendTo", "readonlyInput", "shortYearCutoff", "monthNavigator", "yearNavigator", "hourFormat", "timeOnly", "stepHour", "stepMinute", "stepSecond", "showSeconds", "required", "showOnFocus", "showWeek", "showClear", "dataType", "selectionMode", "maxDateCount", "showButtonBar", "todayButtonStyleClass", "clearButtonStyleClass", "autoZIndex", "baseZIndex", "panelStyleClass", "panelStyle", "keepInvalid", "hideOnDateTimeSelect", "touchUI", "timeSeparator", "focusTrap", "showTransitionOptions", "hideTransitionOptions", "tabindex", "minDate", "maxDate", "disabledDates", "disabledDays", "yearRange", "showTime", "responsiveOptions", "numberOfMonths", "firstDayOfWeek", "locale", "view", "defaultDate"], outputs: ["onFocus", "onBlur", "onClose", "onSelect", "onClear", "onInput", "onTodayClick", "onClearClick", "onMonthChange", "onYearChange", "onClickOutside", "onShow"] }, { kind: "directive", type: i5.PrimeTemplate, selector: "[pTemplate]", inputs: ["type", "pTemplate"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i1.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "ngmodule", type: OverlayPanelModule }, { kind: "ngmodule", type: DropdownModule }, { kind: "component", type: i6.Dropdown, selector: "p-dropdown", inputs: ["scrollHeight", "filter", "name", "style", "panelStyle", "styleClass", "panelStyleClass", "readonly", "required", "editable", "appendTo", "tabindex", "placeholder", "filterPlaceholder", "filterLocale", "inputId", "selectId", "dataKey", "filterBy", "autofocus", "resetFilterOnHide", "dropdownIcon", "optionLabel", "optionValue", "optionDisabled", "optionGroupLabel", "optionGroupChildren", "autoDisplayFirst", "group", "showClear", "emptyFilterMessage", "emptyMessage", "lazy", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "overlayOptions", "ariaFilterLabel", "ariaLabel", "ariaLabelledBy", "filterMatchMode", "maxlength", "tooltip", "tooltipPosition", "tooltipPositionStyle", "tooltipStyleClass", "autofocusFilter", "overlayDirection", "disabled", "itemSize", "autoZIndex", "baseZIndex", "showTransitionOptions", "hideTransitionOptions", "filterValue", "options"], outputs: ["onChange", "onFilter", "onFocus", "onBlur", "onClick", "onShow", "onHide", "onClear", "onLazyLoad"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: DatePickerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'date-picker', standalone: true, imports: [
                        MaLibModule,
                        ReactiveFormsModule,
                        CalendarModule,
                        FormsModule,
                        OverlayPanelModule,
                        DropdownModule
                    ], providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => DatePickerComponent),
                            multi: true,
                        },
                    ], template: "<div class=\"combo-datepicker\">\n  <div class=\"p-inputgroup\">\n    <span class=\"p-inputgroup-addon\">\n      <p-dropdown [options]=\"dateOptions\" [(ngModel)]=\"dateOption\" [ngModelOptions]=\" \n             {standalone: true}\" (ngModelChange)=\"onChangeDateOption($event)\" [optionLabel]=\"'label'\"\n        [optionValue]=\"'value'\">\n        <ng-template let-selectedItem pTemplate=\"selectedItem\">\n          <span *ngIf=\"selectedItem\">\n            {{ selectedItem.label | translate}}\n          </span>\n          <span *ngIf=\"!selectedItem \">\n            {{ 'all' | translate }}\n          </span>\n        </ng-template>\n        <ng-template pTemplate=\"option\" let-option>{{option.label | translate}} </ng-template>\n      </p-dropdown>\n    </span>\n    <div class=\"date-picker date-picker-container \">\n      <div class=\"calendar-container\">\n        <p-calendar [formControl]=\"control\" [minDate]=\"minDate\" [maxDate]=\"maxDate\" (onFocus)=\"onCalendarOpen()\"\n          #calendar (onSelect)=\"onSelectDate($event)\" [styleClass]=\"dateOption =='weekly'?'date-picker-week' : ''\"\n          [view]=\"dateOption =='monthly'?'month': 'date'\" [selectionMode]=\"dateOption =='weekly'?'range':'single'\"\n          [dateFormat]=\"dateOption =='monthly'?'mm/yy': 'dd/mm/yy'\" [showWeek]=\"dateOption =='weekly'\"\n          [placeholder]=\"'Select Date'\"></p-calendar>\n      </div>\n    </div>\n  </div>\n</div>", styles: [".date-picker-container{display:flex}.date-picker-container ::ng-deep .p-calendar .p-datepicker{width:unset!important}.date-picker-container ::ng-deep .p-datepicker.p-datepicker-multiple-month .p-datepicker-group{border-left:unset!important}.date-picker-container ::ng-deep .p-datepicker{border:unset}.date-picker-container ::ng-deep .p-datepicker td>span{margin:0}.date-picker-container ::ng-deep .p-datepicker table th{padding:2px}.date-picker-container ::ng-deep .p-datepicker table td>span{width:34px;height:32px;border-radius:4px}.date-picker-container ::ng-deep .p-datepicker table td{padding:2px 0}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{border-radius:4px;background:#2e6be5!important;color:#fff!important}.date-picker-container ::ng-deep .p-datepicker table td.p-datepicker-today span{border-radius:4px;color:#2e6be5;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{color:#404040;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header{border-bottom:unset}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header .p-datepicker-title .p-datepicker-month{margin-right:.5rem!important}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-prev,.date-picker-container ::ng-deep .p-datepicker .p-datepicker-next{border:1px solid #E6E6E6;border-radius:4px;height:32px;width:32px}.date-picker-container .time-intervals{flex:0 0 136px;border-right:1px solid #e6e6e6;padding-right:8px}.date-picker-container .time-intervals ul{list-style:none;padding:0;margin:0}.date-picker-container .time-intervals ul li{cursor:pointer;padding:14px 0;font-size:14px;color:#333;font-weight:400}.date-picker-container .time-intervals ul li:hover,.date-picker-container .time-intervals ul li.active{font-weight:600}.date-picker-container .calendar-container{flex:1}.date-range-actions{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem;border-top:1px solid #E6E6E6;padding-top:16px;align-items:center}.date-range-actions button{min-width:80px}.date-range-actions .date-range-value{color:#6c6c6c;padding-right:16px}.button-custom-date-range{padding:0;border:unset!important;box-shadow:unset!important;background:#fff!important;max-width:20vw;text-align:left;display:block}.value-range{color:#404040;font-weight:400;line-height:20px;padding-top:5px;font-size:14px;display:block}.p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker{padding-right:16px}::ng-deep .combo-datepicker .p-datepicker-weekheader{padding-right:24px!important}::ng-deep .combo-datepicker .p-datepicker-weeknumber{padding-right:24px!important}::ng-deep .combo-datepicker .p-inputgroup .p-inputwrapper>.p-component{width:unset}::ng-deep .combo-datepicker .p-dropdown{border:unset;border-radius:unset;border-top-left-radius:6px;border-bottom-left-radius:6px}::ng-deep .combo-datepicker .p-dropdown-label{max-width:10vw}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext{border-radius:0 6px 6px 0}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext:has(+.p-inputgroup-addon .circle-x){border-right:unset}::ng-deep .combo-datepicker .p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.pi-search){padding-left:12px;min-width:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.circle-x){border-left:unset}::ng-deep .combo-datepicker .p-inputtext:enabled:focus{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-inputtext:enabled:hover{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-dropdown:not(.p-disabled).p-focus{box-shadow:unset;border-color:#d1d5db}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month{padding:10px}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month.p-highlight{background:#2e6be5!important;color:#fff!important}::ng-deep .date-picker-week .week-highlight td{background-color:#2e6be5!important;color:#fff!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week .week-highlight td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week .week-highlight td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td{background-color:#f5f5f5!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week .p-datepicker:not(.p-disabled) table td span:not(.p-highlight):not(.p-disabled):hover{background-color:unset!important}::ng-deep .date-picker-week .p-datepicker table td span.p-highlight{background-color:unset!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ControlContainer, decorators: [{
                    type: Optional
                }] }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { label: [{
                type: Input
            }], maxDate: [{
                type: Input
            }], minDate: [{
                type: Input
            }], showTime: [{
                type: Input
            }], calendar: [{
                type: ViewChild,
                args: ['calendar']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWEtbGliL3NyYy9saWIvY29tcG9uZW50L2Zvcm0vZGF0ZS1waWNrZXIvZGF0ZS1waWNrZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWEtbGliL3NyYy9saWIvY29tcG9uZW50L2Zvcm0vZGF0ZS1waWNrZXIvZGF0ZS1waWNrZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsS0FBSyxFQUVMLFFBQVEsRUFFUixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUErQixXQUFXLEVBQUUsaUJBQWlCLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNsSCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUMxRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMxRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7Ozs7Ozs7QUF1QnJELE1BQU0sT0FBTyxtQkFBb0IsU0FBUSx3QkFBd0I7SUFpQi9ELFlBQXdDLGdCQUFrQyxFQUNoRSxHQUFzQjtRQUU5QixLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUhjLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDaEUsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFqQnZCLFVBQUssR0FBVyxFQUFFLENBQUM7UUFJbkIsYUFBUSxHQUFZLElBQUksQ0FBQztRQUVsQyxlQUFVLEdBQUcs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LElBQUk7YUFDWjtTQUNGLHVKQ3BDSCxvNkNBMkJNLHErSkRMRixXQUFXLCtMQUNYLG1CQUFtQix5VEFDbkIsY0FBYyw0ekNBQ2QsV0FBVyxzUEFDWCxrQkFBa0IsOEJBQ2xCLGNBQWM7OzRGQVdMLG1CQUFtQjtrQkFyQi9CLFNBQVM7K0JBQ0UsYUFBYSxjQUVYLElBQUksV0FDUDt3QkFDUCxXQUFXO3dCQUNYLG1CQUFtQjt3QkFDbkIsY0FBYzt3QkFDZCxXQUFXO3dCQUNYLGtCQUFrQjt3QkFDbEIsY0FBYztxQkFDZixhQUVVO3dCQUNUOzRCQUNFLE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLG9CQUFvQixDQUFDOzRCQUNsRCxLQUFLLEVBQUUsSUFBSTt5QkFDWjtxQkFDRjs7MEJBbUJZLFFBQVE7NEVBaEJaLEtBQUs7c0JBQWIsS0FBSztnQkFFRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBU3lCLFFBQVE7c0JBQXRDLFNBQVM7dUJBQUMsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIGZvcndhcmRSZWYsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIE9wdGlvbmFsLFxuICBPdXRwdXQsXG4gIFZpZXdDaGlsZCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sQ29udGFpbmVyLCBGb3JtR3JvdXAsIEZvcm1zTW9kdWxlLCBOR19WQUxVRV9BQ0NFU1NPUiwgUmVhY3RpdmVGb3Jtc01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEJhc2VDb250cm9sVmFsdWVBY2Nlc3NvciB9IGZyb20gJy4uL2Jhc2UtY29udHJvbC12YWx1ZS1hY2Nlc3Nvcic7XG5pbXBvcnQgeyBPdmVybGF5UGFuZWxNb2R1bGUgfSBmcm9tICdwcmltZW5nL292ZXJsYXlwYW5lbCc7XG5pbXBvcnQgeyBDYWxlbmRhck1vZHVsZSB9IGZyb20gJ3ByaW1lbmcvY2FsZW5kYXInO1xuaW1wb3J0IHsgRHJvcGRvd25Nb2R1bGUgfSBmcm9tICdwcmltZW5nL2Ryb3Bkb3duJztcbmltcG9ydCB7IE1hTGliTW9kdWxlIH0gZnJvbSAnLi4vLi4vLi4vbWEtbGliLm1vZHVsZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2RhdGUtcGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RhdGUtcGlja2VyLmNvbXBvbmVudC5odG1sJyxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIE1hTGliTW9kdWxlLFxuICAgIFJlYWN0aXZlRm9ybXNNb2R1bGUsXG4gICAgQ2FsZW5kYXJNb2R1bGUsXG4gICAgRm9ybXNNb2R1bGUsXG4gICAgT3ZlcmxheVBhbmVsTW9kdWxlLFxuICAgIERyb3Bkb3duTW9kdWxlXG4gIF0sXG4gIHN0eWxlVXJsczogWydkYXRlLXBpY2tlci5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IERhdGVQaWNrZXJDb21wb25lbnQpLFxuICAgICAgbXVsdGk6IHRydWUsXG4gICAgfSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgRGF0ZVBpY2tlckNvbXBvbmVudCBleHRlbmRzIEJhc2VDb250cm9sVmFsdWVBY2Nlc3NvciBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIGxhYmVsOiBzdHJpbmcgPSAnJztcblxuICBASW5wdXQoKSBtYXhEYXRlOiBEYXRlO1xuICBASW5wdXQoKSBtaW5EYXRlOiBEYXRlO1xuICBASW5wdXQoKSBzaG93VGltZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgZGF0ZU9wdGlvbiA9ICdkYWlseSc7XG4gIGRhdGVPcHRpb25zOiBhbnkgPSBbXG4gICAgeyBsYWJlbDogJ2RhaWx5JywgdmFsdWU6ICdkYWlseScgfSxcbiAgICB7IGxhYmVsOiAnd2Vla2x5JywgdmFsdWU6ICd3ZWVrbHknIH0sXG4gICAgeyBsYWJlbDogJ21vbnRobHknLCB2YWx1ZTogJ21vbnRobHknIH0sXG4gIF1cblxuICBAVmlld0NoaWxkKCdjYWxlbmRhcicpIHByaXZhdGUgY2FsZW5kYXI6IGFueTtcblxuXG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHB1YmxpYyBvdmVycmlkZSBjb250cm9sQ29udGFpbmVyOiBDb250cm9sQ29udGFpbmVyLFxuICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZlxuICApIHtcbiAgICBzdXBlcihjb250cm9sQ29udGFpbmVyKTtcbiAgfVxuXG4gIGdldCBmb3JtR3JvdXAoKTogRm9ybUdyb3VwIHtcbiAgICByZXR1cm4gdGhpcy5jb250cm9sQ29udGFpbmVyPy5jb250cm9sIGFzIEZvcm1Hcm91cDtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuY29udHJvbC52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuaGlnaGxpZ2h0V2VlaygpO1xuICAgICAgaWYgKHRoaXMuY29udHJvbC52YWx1ZSAmJiB0aGlzLmNvbnRyb2wudmFsdWUubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIGNvbnN0IFtmcm9tRGF0ZSwgdG9EYXRlXSA9IHRoaXMuY29udHJvbC52YWx1ZTtcbiAgICAgICAgY29uc3Qgb25lWWVhckluTWlsbGlzID0gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICAgICAgaWYgKHRvRGF0ZSAmJiAodG9EYXRlLmdldFRpbWUoKSAtIGZyb21EYXRlLmdldFRpbWUoKSA+IG9uZVllYXJJbk1pbGxpcykpIHtcbiAgICAgICAgICBjb25zdCBhZGp1c3RlZFRvRGF0ZSA9IG5ldyBEYXRlKGZyb21EYXRlLmdldFRpbWUoKSArIG9uZVllYXJJbk1pbGxpcyk7XG4gICAgICAgICAgdGhpcy5jb250cm9sLnNldFZhbHVlKFtmcm9tRGF0ZSwgYWRqdXN0ZWRUb0RhdGVdLCB7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBvblRpbWVDaGFuZ2UoKSB7XG4gICAgdGhpcy5jb250cm9sLnNldFZhbHVlKHRoaXMuY29udHJvbC52YWx1ZSk7XG4gIH1cbiAgb25DYWxlbmRhck9wZW4oKSB7XG4gICAgaWYgKHRoaXMuY29udHJvbC52YWx1ZSkge1xuICAgICAgdGhpcy5oaWdobGlnaHRXZWVrKCk7XG4gICAgfVxuICB9XG4gIGhpZ2hsaWdodFdlZWsoKSB7XG4gICAgaWYgKHRoaXMuZGF0ZU9wdGlvbiAhPT0gJ3dlZWtseScpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zdCBjZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kYXRlLXBpY2tlciB0cicpO1xuICAgICAgY2VsbHMuZm9yRWFjaChjZWxsID0+IHtcbiAgICAgICAgY29uc3Qgc3BhbiA9IGNlbGwucXVlcnlTZWxlY3Rvcignc3Bhbi5wLWhpZ2hsaWdodCcpO1xuICAgICAgICBpZiAoc3Bhbikge1xuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnd2Vlay1oaWdobGlnaHQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSwgNTApO1xuICB9XG4gIG9uQ2hhbmdlRGF0ZU9wdGlvbihldmVudDogYW55KSB7XG4gICAgbGV0IGRhdGUgPSB0aGlzLmNvbnRyb2wudmFsdWVcblxuICAgIGlmIChkYXRlICYmIGRhdGUubGVuZ3RoID09IDIpIHtcbiAgICAgIHRoaXMub25TZWxlY3REYXRlKGRhdGVbMF0sIHRydWUpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub25TZWxlY3REYXRlKHRoaXMuY29udHJvbC52YWx1ZSwgdHJ1ZSlcbiAgICB9XG4gICAgY29uc3QgY3VycmVudFZhbHVlID0gdGhpcy5jb250cm9sLnZhbHVlO1xuICAgIHRoaXMuY29udHJvbC5zZXRWYWx1ZShudWxsLCB7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgdGhpcy5jb250cm9sLnNldFZhbHVlKGN1cnJlbnRWYWx1ZSk7XG5cbiAgfVxuXG4gIG9uU2VsZWN0RGF0ZShzZWxlY3RlZERhdGU6IGFueSwgYnlPcHRpb24gPSBmYWxzZSk6IHZvaWQge1xuICAgIGlmICghc2VsZWN0ZWREYXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmRhdGVPcHRpb24gPT09ICd3ZWVrbHknKSB7XG4gICAgICBjb25zdCBzdGFydE9mV2VlayA9IHRoaXMuZ2V0U3RhcnRPZldlZWsoc2VsZWN0ZWREYXRlKTtcbiAgICAgIGNvbnN0IGVuZE9mV2VlayA9IHRoaXMuZ2V0RW5kT2ZXZWVrKHNlbGVjdGVkRGF0ZSk7XG4gICAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUoW3N0YXJ0T2ZXZWVrLCBlbmRPZldlZWtdKTtcbiAgICAgIHRoaXMuY2FsZW5kYXIub3ZlcmxheVZpc2libGUgPSBmYWxzZTtcblxuICAgIH0gZWxzZSBpZiAodGhpcy5kYXRlT3B0aW9uID09PSAnbW9udGhseScgJiYgYnlPcHRpb24pIHtcbiAgICAgIGNvbnN0IHN0YXJ0T2ZNb250aCA9IHRoaXMuZ2V0U3RhcnRPZk1vbnRoKHNlbGVjdGVkRGF0ZSk7XG4gICAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUoc3RhcnRPZk1vbnRoLCB7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmRhdGVPcHRpb24gPT09ICdkYWlseScgJiYgYnlPcHRpb24pIHtcbiAgICAgIHRoaXMuY29udHJvbC5zZXRWYWx1ZShzZWxlY3RlZERhdGUsIHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBnZXRTdGFydE9mTW9udGgoZGF0ZTogRGF0ZSk6IERhdGUge1xuICAgIGNvbnNvbGUubG9nKGRhdGUpO1xuICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcbiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCksIDEpO1xuICB9XG5cbiAgZ2V0RW5kT2ZNb250aChkYXRlOiBEYXRlKTogRGF0ZSB7XG4gICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xuICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSArIDEsIDApO1xuICB9XG5cbiAgZ2V0U3RhcnRPZldlZWsoZGF0ZTogRGF0ZSk6IERhdGUge1xuICAgIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF5KCk7XG4gICAgY29uc3QgZGlmZiA9IGRhdGUuZ2V0RGF0ZSgpIC0gZGF5O1xuICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLnNldERhdGUoZGlmZikpO1xuICB9XG5cbiAgZ2V0RW5kT2ZXZWVrKGRhdGU6IERhdGUpOiBEYXRlIHtcbiAgICBjb25zdCBzdGFydE9mV2VlayA9IHRoaXMuZ2V0U3RhcnRPZldlZWsoZGF0ZSk7XG4gICAgcmV0dXJuIG5ldyBEYXRlKHN0YXJ0T2ZXZWVrLnNldERhdGUoc3RhcnRPZldlZWsuZ2V0RGF0ZSgpICsgNikpO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY29tYm8tZGF0ZXBpY2tlclwiPlxuICA8ZGl2IGNsYXNzPVwicC1pbnB1dGdyb3VwXCI+XG4gICAgPHNwYW4gY2xhc3M9XCJwLWlucHV0Z3JvdXAtYWRkb25cIj5cbiAgICAgIDxwLWRyb3Bkb3duIFtvcHRpb25zXT1cImRhdGVPcHRpb25zXCIgWyhuZ01vZGVsKV09XCJkYXRlT3B0aW9uXCIgW25nTW9kZWxPcHRpb25zXT1cIiBcbiAgICAgICAgICAgICB7c3RhbmRhbG9uZTogdHJ1ZX1cIiAobmdNb2RlbENoYW5nZSk9XCJvbkNoYW5nZURhdGVPcHRpb24oJGV2ZW50KVwiIFtvcHRpb25MYWJlbF09XCInbGFiZWwnXCJcbiAgICAgICAgW29wdGlvblZhbHVlXT1cIid2YWx1ZSdcIj5cbiAgICAgICAgPG5nLXRlbXBsYXRlIGxldC1zZWxlY3RlZEl0ZW0gcFRlbXBsYXRlPVwic2VsZWN0ZWRJdGVtXCI+XG4gICAgICAgICAgPHNwYW4gKm5nSWY9XCJzZWxlY3RlZEl0ZW1cIj5cbiAgICAgICAgICAgIHt7IHNlbGVjdGVkSXRlbS5sYWJlbCB8IHRyYW5zbGF0ZX19XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDxzcGFuICpuZ0lmPVwiIXNlbGVjdGVkSXRlbSBcIj5cbiAgICAgICAgICAgIHt7ICdhbGwnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwib3B0aW9uXCIgbGV0LW9wdGlvbj57e29wdGlvbi5sYWJlbCB8IHRyYW5zbGF0ZX19IDwvbmctdGVtcGxhdGU+XG4gICAgICA8L3AtZHJvcGRvd24+XG4gICAgPC9zcGFuPlxuICAgIDxkaXYgY2xhc3M9XCJkYXRlLXBpY2tlciBkYXRlLXBpY2tlci1jb250YWluZXIgXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY2FsZW5kYXItY29udGFpbmVyXCI+XG4gICAgICAgIDxwLWNhbGVuZGFyIFtmb3JtQ29udHJvbF09XCJjb250cm9sXCIgW21pbkRhdGVdPVwibWluRGF0ZVwiIFttYXhEYXRlXT1cIm1heERhdGVcIiAob25Gb2N1cyk9XCJvbkNhbGVuZGFyT3BlbigpXCJcbiAgICAgICAgICAjY2FsZW5kYXIgKG9uU2VsZWN0KT1cIm9uU2VsZWN0RGF0ZSgkZXZlbnQpXCIgW3N0eWxlQ2xhc3NdPVwiZGF0ZU9wdGlvbiA9PSd3ZWVrbHknPydkYXRlLXBpY2tlci13ZWVrJyA6ICcnXCJcbiAgICAgICAgICBbdmlld109XCJkYXRlT3B0aW9uID09J21vbnRobHknPydtb250aCc6ICdkYXRlJ1wiIFtzZWxlY3Rpb25Nb2RlXT1cImRhdGVPcHRpb24gPT0nd2Vla2x5Jz8ncmFuZ2UnOidzaW5nbGUnXCJcbiAgICAgICAgICBbZGF0ZUZvcm1hdF09XCJkYXRlT3B0aW9uID09J21vbnRobHknPydtbS95eSc6ICdkZC9tbS95eSdcIiBbc2hvd1dlZWtdPVwiZGF0ZU9wdGlvbiA9PSd3ZWVrbHknXCJcbiAgICAgICAgICBbcGxhY2Vob2xkZXJdPVwiJ1NlbGVjdCBEYXRlJ1wiPjwvcC1jYWxlbmRhcj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PiJdfQ==