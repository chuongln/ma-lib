import { Component, EventEmitter, forwardRef, Input, Optional, Output, ViewChild, } from '@angular/core';
import { FormsModule, NG_VALUE_ACCESSOR, ReactiveFormsModule } from '@angular/forms';
import { BaseControlValueAccessor } from '../base-control-value-accessor';
import { OverlayPanelModule } from 'primeng/overlaypanel';
import { CalendarModule } from 'primeng/calendar';
import { DropdownModule } from 'primeng/dropdown';
import { MaLibModule } from '../../../ma-lib.module';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common";
import * as i3 from "@ngx-translate/core";
import * as i4 from "primeng/calendar";
import * as i5 from "primeng/api";
import * as i6 from "primeng/dropdown";
export class DatePickerComponent extends BaseControlValueAccessor {
    constructor(controlContainer, cdr) {
        super(controlContainer);
        this.controlContainer = controlContainer;
        this.cdr = cdr;
        this.label = '';
        this.showTime = true;
        this.dateOption = 'daily';
        this.dateOptions = [
            { label: 'daily', value: 'daily' },
            { label: 'weekly', value: 'weekly' },
            { label: 'monthly', value: 'monthly' },
        ];
        this.onChangeInterval = new EventEmitter();
    }
    get formGroup() {
        return this.controlContainer?.control;
    }
    ngOnInit() {
        this.control.valueChanges.subscribe(() => {
            this.highlightWeek();
            if (this.control.value && this.control.value.length === 2) {
                const [fromDate, toDate] = this.control.value;
                const oneYearInMillis = 365 * 24 * 60 * 60 * 1000;
                if (toDate && (toDate.getTime() - fromDate.getTime() > oneYearInMillis)) {
                    const adjustedToDate = new Date(fromDate.getTime() + oneYearInMillis);
                    this.control.setValue([fromDate, adjustedToDate], { emitEvent: false });
                }
            }
        });
    }
    onTimeChange() {
        this.control.setValue(this.control.value);
    }
    onCalendarOpen() {
        if (this.control.value) {
            this.highlightWeek();
        }
    }
    highlightWeek() {
        if (this.dateOption !== 'weekly') {
            return;
        }
        setTimeout(() => {
            const cells = document.querySelectorAll('.date-picker tr');
            cells.forEach(cell => {
                const span = cell.querySelector('span.p-highlight');
                if (span) {
                    cell.classList.add('week-highlight');
                }
            });
        }, 50);
    }
    onChangeDateOption(event) {
        let date = this.control.value;
        if (date && date.length == 2) {
            this.onSelectDate(date[0], true);
        }
        else {
            this.onSelectDate(this.control.value, true);
        }
        const currentValue = this.control.value;
        this.control.setValue(null, { emitEvent: false });
        this.control.setValue(currentValue);
        this.onChangeInterval.emit(event);
    }
    onSelectDate(selectedDate, byOption = false) {
        if (!selectedDate) {
            return;
        }
        if (this.dateOption === 'weekly') {
            const startOfWeek = this.getStartOfWeek(selectedDate);
            const endOfWeek = this.getEndOfWeek(selectedDate);
            this.control.setValue([startOfWeek, endOfWeek]);
            this.calendar.overlayVisible = false;
        }
        else if (this.dateOption === 'monthly' && byOption) {
            const startOfMonth = this.getStartOfMonth(selectedDate);
            this.control.setValue(startOfMonth, { emitEvent: false });
        }
        else if (this.dateOption === 'daily' && byOption) {
            this.control.setValue(selectedDate, { emitEvent: false });
        }
        this.cdr.detectChanges();
    }
    getStartOfMonth(date) {
        date = new Date(date);
        return new Date(date.getFullYear(), date.getMonth(), 1);
    }
    getEndOfMonth(date) {
        date = new Date(date);
        return new Date(date.getFullYear(), date.getMonth() + 1, 0);
    }
    getStartOfWeek(date) {
        const day = date.getDay();
        const diff = date.getDate() - day + 1;
        return new Date(date.setDate(diff));
    }
    getEndOfWeek(date) {
        const startOfWeek = this.getStartOfWeek(date);
        return new Date(startOfWeek.setDate(startOfWeek.getDate() + 6));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: DatePickerComponent, deps: [{ token: i1.ControlContainer, optional: true }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: DatePickerComponent, isStandalone: true, selector: "date-picker", inputs: { label: "label", maxDate: "maxDate", minDate: "minDate", showTime: "showTime" }, outputs: { onChangeInterval: "onChangeInterval" }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => DatePickerComponent),
                multi: true,
            },
        ], viewQueries: [{ propertyName: "calendar", first: true, predicate: ["calendar"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<div class=\"combo-datepicker\">\n  <div class=\"p-inputgroup\">\n    <span class=\"p-inputgroup-addon\">\n      <p-dropdown [options]=\"dateOptions\" [(ngModel)]=\"dateOption\" [ngModelOptions]=\" \n             {standalone: true}\" (ngModelChange)=\"onChangeDateOption($event)\" [optionLabel]=\"'label'\"\n        [optionValue]=\"'value'\">\n        <ng-template let-selectedItem pTemplate=\"selectedItem\">\n          <span *ngIf=\"selectedItem\">\n            {{ selectedItem.label | translate}}\n          </span>\n          <span *ngIf=\"!selectedItem \">\n            {{ 'all' | translate }}\n          </span>\n        </ng-template>\n        <ng-template pTemplate=\"option\" let-option>{{option.label | translate}} </ng-template>\n      </p-dropdown>\n    </span>\n    <div class=\"date-picker date-picker-container \">\n      <div class=\"calendar-container\">\n        <p-calendar  [firstDayOfWeek]=\"1\"  [formControl]=\"control\" [minDate]=\"minDate\" [maxDate]=\"maxDate\" (onFocus)=\"onCalendarOpen()\"\n          #calendar (onSelect)=\"onSelectDate($event)\" [styleClass]=\"dateOption =='weekly'?'date-picker-week' : ''\"\n          [view]=\"dateOption =='monthly'?'month': 'date'\" [selectionMode]=\"dateOption =='weekly'?'range':'single'\"\n          [dateFormat]=\"dateOption =='monthly'?'mm/yy': 'dd/mm/yy'\" [showWeek]=\"dateOption =='weekly'\"\n          [placeholder]=\"'Select Date'\"></p-calendar>\n      </div>\n    </div>\n  </div>\n</div>", styles: [".date-picker-container{display:flex}.date-picker-container ::ng-deep .p-calendar .p-datepicker{width:unset!important}.date-picker-container ::ng-deep .p-datepicker.p-datepicker-multiple-month .p-datepicker-group{border-left:unset!important}.date-picker-container ::ng-deep .p-datepicker{border:unset}.date-picker-container ::ng-deep .p-datepicker td>span{margin:0}.date-picker-container ::ng-deep .p-datepicker table th{padding:2px}.date-picker-container ::ng-deep .p-datepicker table td>span{width:34px;height:32px;border-radius:4px}.date-picker-container ::ng-deep .p-datepicker table td{padding:2px 0}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{border-radius:4px;background:#2e6be5!important;color:#fff!important}.date-picker-container ::ng-deep .p-datepicker table td.p-datepicker-today span{border-radius:4px;color:#2e6be5;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{color:#404040;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header{border-bottom:unset}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header .p-datepicker-title .p-datepicker-month{margin-right:.5rem!important}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-prev,.date-picker-container ::ng-deep .p-datepicker .p-datepicker-next{border:1px solid #E6E6E6;border-radius:4px;height:32px;width:32px}.date-picker-container .time-intervals{flex:0 0 136px;border-right:1px solid #e6e6e6;padding-right:8px}.date-picker-container .time-intervals ul{list-style:none;padding:0;margin:0}.date-picker-container .time-intervals ul li{cursor:pointer;padding:14px 0;font-size:14px;color:#333;font-weight:400}.date-picker-container .time-intervals ul li:hover,.date-picker-container .time-intervals ul li.active{font-weight:600}.date-picker-container .calendar-container{flex:1}.date-range-actions{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem;border-top:1px solid #E6E6E6;padding-top:16px;align-items:center}.date-range-actions button{min-width:80px}.date-range-actions .date-range-value{color:#6c6c6c;padding-right:16px}.button-custom-date-range{padding:0;border:unset!important;box-shadow:unset!important;background:#fff!important;max-width:20vw;text-align:left;display:block}.value-range{color:#404040;font-weight:400;line-height:20px;padding-top:5px;font-size:14px;display:block}.p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker{padding-right:16px}::ng-deep .combo-datepicker .p-datepicker-weekheader{padding-right:24px!important}::ng-deep .combo-datepicker .p-datepicker-weeknumber{padding-right:24px!important}::ng-deep .combo-datepicker .p-inputgroup .p-inputwrapper>.p-component{width:unset}::ng-deep .combo-datepicker .p-dropdown{border:unset;border-radius:unset;border-top-left-radius:6px;border-bottom-left-radius:6px}::ng-deep .combo-datepicker .p-dropdown-label{max-width:10vw}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext{border-radius:0 6px 6px 0}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext:has(+.p-inputgroup-addon .circle-x){border-right:unset}::ng-deep .combo-datepicker .p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.pi-search){padding-left:12px;min-width:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.circle-x){border-left:unset}::ng-deep .combo-datepicker .p-inputtext:enabled:focus{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-inputtext:enabled:hover{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-dropdown:not(.p-disabled).p-focus{box-shadow:unset;border-color:#d1d5db}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month{padding:10px}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month.p-highlight{background:#2e6be5!important;color:#fff!important}::ng-deep .date-picker-week .week-highlight td{background-color:#2e6be5!important;color:#fff!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week .week-highlight td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week .week-highlight td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td{background-color:#f5f5f5!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week .p-datepicker:not(.p-disabled) table td span:not(.p-highlight):not(.p-disabled):hover{background-color:unset!important}::ng-deep .date-picker-week .p-datepicker table td span.p-highlight{background-color:unset!important}\n"], dependencies: [{ kind: "ngmodule", type: MaLibModule }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i3.TranslatePipe, name: "translate" }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "ngmodule", type: CalendarModule }, { kind: "component", type: i4.Calendar, selector: "p-calendar", inputs: ["style", "styleClass", "inputStyle", "inputId", "name", "inputStyleClass", "placeholder", "ariaLabelledBy", "iconAriaLabel", "disabled", "dateFormat", "multipleSeparator", "rangeSeparator", "inline", "showOtherMonths", "selectOtherMonths", "showIcon", "icon", "appendTo", "readonlyInput", "shortYearCutoff", "monthNavigator", "yearNavigator", "hourFormat", "timeOnly", "stepHour", "stepMinute", "stepSecond", "showSeconds", "required", "showOnFocus", "showWeek", "showClear", "dataType", "selectionMode", "maxDateCount", "showButtonBar", "todayButtonStyleClass", "clearButtonStyleClass", "autoZIndex", "baseZIndex", "panelStyleClass", "panelStyle", "keepInvalid", "hideOnDateTimeSelect", "touchUI", "timeSeparator", "focusTrap", "showTransitionOptions", "hideTransitionOptions", "tabindex", "minDate", "maxDate", "disabledDates", "disabledDays", "yearRange", "showTime", "responsiveOptions", "numberOfMonths", "firstDayOfWeek", "locale", "view", "defaultDate"], outputs: ["onFocus", "onBlur", "onClose", "onSelect", "onClear", "onInput", "onTodayClick", "onClearClick", "onMonthChange", "onYearChange", "onClickOutside", "onShow"] }, { kind: "directive", type: i5.PrimeTemplate, selector: "[pTemplate]", inputs: ["type", "pTemplate"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i1.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "ngmodule", type: OverlayPanelModule }, { kind: "ngmodule", type: DropdownModule }, { kind: "component", type: i6.Dropdown, selector: "p-dropdown", inputs: ["scrollHeight", "filter", "name", "style", "panelStyle", "styleClass", "panelStyleClass", "readonly", "required", "editable", "appendTo", "tabindex", "placeholder", "filterPlaceholder", "filterLocale", "inputId", "selectId", "dataKey", "filterBy", "autofocus", "resetFilterOnHide", "dropdownIcon", "optionLabel", "optionValue", "optionDisabled", "optionGroupLabel", "optionGroupChildren", "autoDisplayFirst", "group", "showClear", "emptyFilterMessage", "emptyMessage", "lazy", "virtualScroll", "virtualScrollItemSize", "virtualScrollOptions", "overlayOptions", "ariaFilterLabel", "ariaLabel", "ariaLabelledBy", "filterMatchMode", "maxlength", "tooltip", "tooltipPosition", "tooltipPositionStyle", "tooltipStyleClass", "autofocusFilter", "overlayDirection", "disabled", "itemSize", "autoZIndex", "baseZIndex", "showTransitionOptions", "hideTransitionOptions", "filterValue", "options"], outputs: ["onChange", "onFilter", "onFocus", "onBlur", "onClick", "onShow", "onHide", "onClear", "onLazyLoad"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: DatePickerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'date-picker', standalone: true, imports: [
                        MaLibModule,
                        ReactiveFormsModule,
                        CalendarModule,
                        FormsModule,
                        OverlayPanelModule,
                        DropdownModule
                    ], providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => DatePickerComponent),
                            multi: true,
                        },
                    ], template: "<div class=\"combo-datepicker\">\n  <div class=\"p-inputgroup\">\n    <span class=\"p-inputgroup-addon\">\n      <p-dropdown [options]=\"dateOptions\" [(ngModel)]=\"dateOption\" [ngModelOptions]=\" \n             {standalone: true}\" (ngModelChange)=\"onChangeDateOption($event)\" [optionLabel]=\"'label'\"\n        [optionValue]=\"'value'\">\n        <ng-template let-selectedItem pTemplate=\"selectedItem\">\n          <span *ngIf=\"selectedItem\">\n            {{ selectedItem.label | translate}}\n          </span>\n          <span *ngIf=\"!selectedItem \">\n            {{ 'all' | translate }}\n          </span>\n        </ng-template>\n        <ng-template pTemplate=\"option\" let-option>{{option.label | translate}} </ng-template>\n      </p-dropdown>\n    </span>\n    <div class=\"date-picker date-picker-container \">\n      <div class=\"calendar-container\">\n        <p-calendar  [firstDayOfWeek]=\"1\"  [formControl]=\"control\" [minDate]=\"minDate\" [maxDate]=\"maxDate\" (onFocus)=\"onCalendarOpen()\"\n          #calendar (onSelect)=\"onSelectDate($event)\" [styleClass]=\"dateOption =='weekly'?'date-picker-week' : ''\"\n          [view]=\"dateOption =='monthly'?'month': 'date'\" [selectionMode]=\"dateOption =='weekly'?'range':'single'\"\n          [dateFormat]=\"dateOption =='monthly'?'mm/yy': 'dd/mm/yy'\" [showWeek]=\"dateOption =='weekly'\"\n          [placeholder]=\"'Select Date'\"></p-calendar>\n      </div>\n    </div>\n  </div>\n</div>", styles: [".date-picker-container{display:flex}.date-picker-container ::ng-deep .p-calendar .p-datepicker{width:unset!important}.date-picker-container ::ng-deep .p-datepicker.p-datepicker-multiple-month .p-datepicker-group{border-left:unset!important}.date-picker-container ::ng-deep .p-datepicker{border:unset}.date-picker-container ::ng-deep .p-datepicker td>span{margin:0}.date-picker-container ::ng-deep .p-datepicker table th{padding:2px}.date-picker-container ::ng-deep .p-datepicker table td>span{width:34px;height:32px;border-radius:4px}.date-picker-container ::ng-deep .p-datepicker table td{padding:2px 0}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{border-radius:4px;background:#2e6be5!important;color:#fff!important}.date-picker-container ::ng-deep .p-datepicker table td.p-datepicker-today span{border-radius:4px;color:#2e6be5;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker table td span.p-highlight{color:#404040;background:#edf3ff}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header{border-bottom:unset}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-header .p-datepicker-title .p-datepicker-month{margin-right:.5rem!important}.date-picker-container ::ng-deep .p-datepicker .p-datepicker-prev,.date-picker-container ::ng-deep .p-datepicker .p-datepicker-next{border:1px solid #E6E6E6;border-radius:4px;height:32px;width:32px}.date-picker-container .time-intervals{flex:0 0 136px;border-right:1px solid #e6e6e6;padding-right:8px}.date-picker-container .time-intervals ul{list-style:none;padding:0;margin:0}.date-picker-container .time-intervals ul li{cursor:pointer;padding:14px 0;font-size:14px;color:#333;font-weight:400}.date-picker-container .time-intervals ul li:hover,.date-picker-container .time-intervals ul li.active{font-weight:600}.date-picker-container .calendar-container{flex:1}.date-range-actions{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem;border-top:1px solid #E6E6E6;padding-top:16px;align-items:center}.date-range-actions button{min-width:80px}.date-range-actions .date-range-value{color:#6c6c6c;padding-right:16px}.button-custom-date-range{padding:0;border:unset!important;box-shadow:unset!important;background:#fff!important;max-width:20vw;text-align:left;display:block}.value-range{color:#404040;font-weight:400;line-height:20px;padding-top:5px;font-size:14px;display:block}.p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker{padding-right:16px}::ng-deep .combo-datepicker .p-datepicker-weekheader{padding-right:24px!important}::ng-deep .combo-datepicker .p-datepicker-weeknumber{padding-right:24px!important}::ng-deep .combo-datepicker .p-inputgroup .p-inputwrapper>.p-component{width:unset}::ng-deep .combo-datepicker .p-dropdown{border:unset;border-radius:unset;border-top-left-radius:6px;border-bottom-left-radius:6px}::ng-deep .combo-datepicker .p-dropdown-label{max-width:10vw}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext{border-radius:0 6px 6px 0}::ng-deep .combo-datepicker .p-inputgroup .p-inputtext:has(+.p-inputgroup-addon .circle-x){border-right:unset}::ng-deep .combo-datepicker .p-inputgroup-addon{padding:unset;background-color:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.pi-search){padding-left:12px;min-width:unset}::ng-deep .combo-datepicker .p-inputgroup-addon:has(.circle-x){border-left:unset}::ng-deep .combo-datepicker .p-inputtext:enabled:focus{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-inputtext:enabled:hover{box-shadow:unset;border-color:#d1d5db;transition:0ms}::ng-deep .combo-datepicker .p-dropdown:not(.p-disabled).p-focus{box-shadow:unset;border-color:#d1d5db}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month{padding:10px}::ng-deep .combo-datepicker .p-monthpicker .p-monthpicker-month.p-highlight{background:#2e6be5!important;color:#fff!important}::ng-deep .date-picker-week .week-highlight td{background-color:#2e6be5!important;color:#fff!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week .week-highlight td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week .week-highlight td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td{background-color:#f5f5f5!important;border-radius:0!important;transition:0s!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:first-child{border-top-left-radius:4px!important;border-bottom-left-radius:4px!important}::ng-deep .date-picker-week tr:not(.week-highlight):hover td:last-child{border-top-right-radius:4px!important;border-bottom-right-radius:4px!important}::ng-deep .date-picker-week .p-datepicker:not(.p-disabled) table td span:not(.p-highlight):not(.p-disabled):hover{background-color:unset!important}::ng-deep .date-picker-week .p-datepicker table td span.p-highlight{background-color:unset!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ControlContainer, decorators: [{
                    type: Optional
                }] }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { label: [{
                type: Input
            }], maxDate: [{
                type: Input
            }], minDate: [{
                type: Input
            }], showTime: [{
                type: Input
            }], calendar: [{
                type: ViewChild,
                args: ['calendar']
            }], onChangeInterval: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWEtbGliL3NyYy9saWIvY29tcG9uZW50L2Zvcm0vZGF0ZS1waWNrZXIvZGF0ZS1waWNrZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWEtbGliL3NyYy9saWIvY29tcG9uZW50L2Zvcm0vZGF0ZS1waWNrZXIvZGF0ZS1waWNrZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUNWLEtBQUssRUFFTCxRQUFRLEVBQ1IsTUFBTSxFQUNOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQStCLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xILE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzFFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzFELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHdCQUF3QixDQUFDOzs7Ozs7OztBQXVCckQsTUFBTSxPQUFPLG1CQUFvQixTQUFRLHdCQUF3QjtJQW1CL0QsWUFBd0MsZ0JBQWtDLEVBQ2hFLEdBQXNCO1FBRTlCLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBSGMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNoRSxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQW5CdkIsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUluQixhQUFRLEdBQVksSUFBSSxD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QUUsaUJBQWlCO2dCQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLG1CQUFtQixDQUFDO2dCQUNsRCxLQUFLLEVBQUUsSUFBSTthQUNaO1NBQ0YsdUpDckNILDY3Q0EyQk0scStKREpGLFdBQVcsK0xBQ1gsbUJBQW1CLHlUQUNuQixjQUFjLDR6Q0FDZCxXQUFXLHNQQUNYLGtCQUFrQiw4QkFDbEIsY0FBYzs7NEZBV0wsbUJBQW1CO2tCQXJCL0IsU0FBUzsrQkFDRSxhQUFhLGNBRVgsSUFBSSxXQUNQO3dCQUNQLFdBQVc7d0JBQ1gsbUJBQW1CO3dCQUNuQixjQUFjO3dCQUNkLFdBQVc7d0JBQ1gsa0JBQWtCO3dCQUNsQixjQUFjO3FCQUNmLGFBRVU7d0JBQ1Q7NEJBQ0UsT0FBTyxFQUFFLGlCQUFpQjs0QkFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsb0JBQW9CLENBQUM7NEJBQ2xELEtBQUssRUFBRSxJQUFJO3lCQUNaO3FCQUNGOzswQkFxQlksUUFBUTs0RUFsQlosS0FBSztzQkFBYixLQUFLO2dCQUVHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFTeUIsUUFBUTtzQkFBdEMsU0FBUzt1QkFBQyxVQUFVO2dCQUVYLGdCQUFnQjtzQkFBekIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgZm9yd2FyZFJlZixcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT3B0aW9uYWwsXG4gIE91dHB1dCxcbiAgVmlld0NoaWxkLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xDb250YWluZXIsIEZvcm1Hcm91cCwgRm9ybXNNb2R1bGUsIE5HX1ZBTFVFX0FDQ0VTU09SLCBSZWFjdGl2ZUZvcm1zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yIH0gZnJvbSAnLi4vYmFzZS1jb250cm9sLXZhbHVlLWFjY2Vzc29yJztcbmltcG9ydCB7IE92ZXJsYXlQYW5lbE1vZHVsZSB9IGZyb20gJ3ByaW1lbmcvb3ZlcmxheXBhbmVsJztcbmltcG9ydCB7IENhbGVuZGFyTW9kdWxlIH0gZnJvbSAncHJpbWVuZy9jYWxlbmRhcic7XG5pbXBvcnQgeyBEcm9wZG93bk1vZHVsZSB9IGZyb20gJ3ByaW1lbmcvZHJvcGRvd24nO1xuaW1wb3J0IHsgTWFMaWJNb2R1bGUgfSBmcm9tICcuLi8uLi8uLi9tYS1saWIubW9kdWxlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZGF0ZS1waWNrZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vZGF0ZS1waWNrZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgTWFMaWJNb2R1bGUsXG4gICAgUmVhY3RpdmVGb3Jtc01vZHVsZSxcbiAgICBDYWxlbmRhck1vZHVsZSxcbiAgICBGb3Jtc01vZHVsZSxcbiAgICBPdmVybGF5UGFuZWxNb2R1bGUsXG4gICAgRHJvcGRvd25Nb2R1bGVcbiAgXSxcbiAgc3R5bGVVcmxzOiBbJ2RhdGUtcGlja2VyLmNvbXBvbmVudC5zY3NzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gRGF0ZVBpY2tlckNvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZSxcbiAgICB9LFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBEYXRlUGlja2VyQ29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yIGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCkgbGFiZWw6IHN0cmluZyA9ICcnO1xuXG4gIEBJbnB1dCgpIG1heERhdGU6IERhdGU7XG4gIEBJbnB1dCgpIG1pbkRhdGU6IERhdGU7XG4gIEBJbnB1dCgpIHNob3dUaW1lOiBib29sZWFuID0gdHJ1ZTtcblxuICBkYXRlT3B0aW9uID0gJ2RhaWx5JztcbiAgZGF0ZU9wdGlvbnM6IGFueSA9IFtcbiAgICB7IGxhYmVsOiAnZGFpbHknLCB2YWx1ZTogJ2RhaWx5JyB9LFxuICAgIHsgbGFiZWw6ICd3ZWVrbHknLCB2YWx1ZTogJ3dlZWtseScgfSxcbiAgICB7IGxhYmVsOiAnbW9udGhseScsIHZhbHVlOiAnbW9udGhseScgfSxcbiAgXVxuXG4gIEBWaWV3Q2hpbGQoJ2NhbGVuZGFyJykgcHJpdmF0ZSBjYWxlbmRhcjogYW55O1xuXG4gIEBPdXRwdXQoKSBvbkNoYW5nZUludGVydmFsID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG5cbiAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHVibGljIG92ZXJyaWRlIGNvbnRyb2xDb250YWluZXI6IENvbnRyb2xDb250YWluZXIsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmXG4gICkge1xuICAgIHN1cGVyKGNvbnRyb2xDb250YWluZXIpO1xuICB9XG5cbiAgZ2V0IGZvcm1Hcm91cCgpOiBGb3JtR3JvdXAge1xuICAgIHJldHVybiB0aGlzLmNvbnRyb2xDb250YWluZXI/LmNvbnRyb2wgYXMgRm9ybUdyb3VwO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5jb250cm9sLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5oaWdobGlnaHRXZWVrKCk7XG4gICAgICBpZiAodGhpcy5jb250cm9sLnZhbHVlICYmIHRoaXMuY29udHJvbC52YWx1ZS5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgY29uc3QgW2Zyb21EYXRlLCB0b0RhdGVdID0gdGhpcy5jb250cm9sLnZhbHVlO1xuICAgICAgICBjb25zdCBvbmVZZWFySW5NaWxsaXMgPSAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwO1xuICAgICAgICBpZiAodG9EYXRlICYmICh0b0RhdGUuZ2V0VGltZSgpIC0gZnJvbURhdGUuZ2V0VGltZSgpID4gb25lWWVhckluTWlsbGlzKSkge1xuICAgICAgICAgIGNvbnN0IGFkanVzdGVkVG9EYXRlID0gbmV3IERhdGUoZnJvbURhdGUuZ2V0VGltZSgpICsgb25lWWVhckluTWlsbGlzKTtcbiAgICAgICAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUoW2Zyb21EYXRlLCBhZGp1c3RlZFRvRGF0ZV0sIHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIG9uVGltZUNoYW5nZSgpIHtcbiAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUodGhpcy5jb250cm9sLnZhbHVlKTtcbiAgfVxuICBvbkNhbGVuZGFyT3BlbigpIHtcbiAgICBpZiAodGhpcy5jb250cm9sLnZhbHVlKSB7XG4gICAgICB0aGlzLmhpZ2hsaWdodFdlZWsoKTtcbiAgICB9XG4gIH1cbiAgaGlnaGxpZ2h0V2VlaygpIHtcbiAgICBpZiAodGhpcy5kYXRlT3B0aW9uICE9PSAnd2Vla2x5Jykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRhdGUtcGlja2VyIHRyJyk7XG4gICAgICBjZWxscy5mb3JFYWNoKGNlbGwgPT4ge1xuICAgICAgICBjb25zdCBzcGFuID0gY2VsbC5xdWVyeVNlbGVjdG9yKCdzcGFuLnAtaGlnaGxpZ2h0Jyk7XG4gICAgICAgIGlmIChzcGFuKSB7XG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCd3ZWVrLWhpZ2hsaWdodCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCA1MCk7XG4gIH1cbiAgb25DaGFuZ2VEYXRlT3B0aW9uKGV2ZW50OiBhbnkpIHtcbiAgICBsZXQgZGF0ZSA9IHRoaXMuY29udHJvbC52YWx1ZVxuXG4gICAgaWYgKGRhdGUgJiYgZGF0ZS5sZW5ndGggPT0gMikge1xuICAgICAgdGhpcy5vblNlbGVjdERhdGUoZGF0ZVswXSwgdHJ1ZSlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vblNlbGVjdERhdGUodGhpcy5jb250cm9sLnZhbHVlLCB0cnVlKVxuICAgIH1cbiAgICBjb25zdCBjdXJyZW50VmFsdWUgPSB0aGlzLmNvbnRyb2wudmFsdWU7XG4gICAgdGhpcy5jb250cm9sLnNldFZhbHVlKG51bGwsIHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUoY3VycmVudFZhbHVlKTtcbiAgICB0aGlzLm9uQ2hhbmdlSW50ZXJ2YWwuZW1pdChldmVudCk7XG4gIH1cblxuICBvblNlbGVjdERhdGUoc2VsZWN0ZWREYXRlOiBhbnksIGJ5T3B0aW9uID0gZmFsc2UpOiB2b2lkIHtcbiAgICBpZiAoIXNlbGVjdGVkRGF0ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5kYXRlT3B0aW9uID09PSAnd2Vla2x5Jykge1xuICAgICAgY29uc3Qgc3RhcnRPZldlZWsgPSB0aGlzLmdldFN0YXJ0T2ZXZWVrKHNlbGVjdGVkRGF0ZSk7XG4gICAgICBjb25zdCBlbmRPZldlZWsgPSB0aGlzLmdldEVuZE9mV2VlayhzZWxlY3RlZERhdGUpO1xuICAgICAgdGhpcy5jb250cm9sLnNldFZhbHVlKFtzdGFydE9mV2VlaywgZW5kT2ZXZWVrXSk7XG4gICAgICB0aGlzLmNhbGVuZGFyLm92ZXJsYXlWaXNpYmxlID0gZmFsc2U7XG5cbiAgICB9IGVsc2UgaWYgKHRoaXMuZGF0ZU9wdGlvbiA9PT0gJ21vbnRobHknICYmIGJ5T3B0aW9uKSB7XG4gICAgICBjb25zdCBzdGFydE9mTW9udGggPSB0aGlzLmdldFN0YXJ0T2ZNb250aChzZWxlY3RlZERhdGUpO1xuICAgICAgdGhpcy5jb250cm9sLnNldFZhbHVlKHN0YXJ0T2ZNb250aCwgeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5kYXRlT3B0aW9uID09PSAnZGFpbHknICYmIGJ5T3B0aW9uKSB7XG4gICAgICB0aGlzLmNvbnRyb2wuc2V0VmFsdWUoc2VsZWN0ZWREYXRlLCB7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgZ2V0U3RhcnRPZk1vbnRoKGRhdGU6IERhdGUpOiBEYXRlIHtcbiAgICBkYXRlID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpLCAxKTtcbiAgfVxuXG4gIGdldEVuZE9mTW9udGgoZGF0ZTogRGF0ZSk6IERhdGUge1xuICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcbiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkgKyAxLCAwKTtcbiAgfVxuXG4gIGdldFN0YXJ0T2ZXZWVrKGRhdGU6IERhdGUpOiBEYXRlIHtcbiAgICBjb25zdCBkYXkgPSBkYXRlLmdldERheSgpO1xuICAgIGNvbnN0IGRpZmYgPSBkYXRlLmdldERhdGUoKSAtIGRheSArIDE7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuc2V0RGF0ZShkaWZmKSk7XG4gIH1cblxuICBnZXRFbmRPZldlZWsoZGF0ZTogRGF0ZSk6IERhdGUge1xuICAgIGNvbnN0IHN0YXJ0T2ZXZWVrID0gdGhpcy5nZXRTdGFydE9mV2VlayhkYXRlKTtcbiAgICByZXR1cm4gbmV3IERhdGUoc3RhcnRPZldlZWsuc2V0RGF0ZShzdGFydE9mV2Vlay5nZXREYXRlKCkgKyA2KSk7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJjb21iby1kYXRlcGlja2VyXCI+XG4gIDxkaXYgY2xhc3M9XCJwLWlucHV0Z3JvdXBcIj5cbiAgICA8c3BhbiBjbGFzcz1cInAtaW5wdXRncm91cC1hZGRvblwiPlxuICAgICAgPHAtZHJvcGRvd24gW29wdGlvbnNdPVwiZGF0ZU9wdGlvbnNcIiBbKG5nTW9kZWwpXT1cImRhdGVPcHRpb25cIiBbbmdNb2RlbE9wdGlvbnNdPVwiIFxuICAgICAgICAgICAgIHtzdGFuZGFsb25lOiB0cnVlfVwiIChuZ01vZGVsQ2hhbmdlKT1cIm9uQ2hhbmdlRGF0ZU9wdGlvbigkZXZlbnQpXCIgW29wdGlvbkxhYmVsXT1cIidsYWJlbCdcIlxuICAgICAgICBbb3B0aW9uVmFsdWVdPVwiJ3ZhbHVlJ1wiPlxuICAgICAgICA8bmctdGVtcGxhdGUgbGV0LXNlbGVjdGVkSXRlbSBwVGVtcGxhdGU9XCJzZWxlY3RlZEl0ZW1cIj5cbiAgICAgICAgICA8c3BhbiAqbmdJZj1cInNlbGVjdGVkSXRlbVwiPlxuICAgICAgICAgICAge3sgc2VsZWN0ZWRJdGVtLmxhYmVsIHwgdHJhbnNsYXRlfX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gKm5nSWY9XCIhc2VsZWN0ZWRJdGVtIFwiPlxuICAgICAgICAgICAge3sgJ2FsbCcgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJvcHRpb25cIiBsZXQtb3B0aW9uPnt7b3B0aW9uLmxhYmVsIHwgdHJhbnNsYXRlfX0gPC9uZy10ZW1wbGF0ZT5cbiAgICAgIDwvcC1kcm9wZG93bj5cbiAgICA8L3NwYW4+XG4gICAgPGRpdiBjbGFzcz1cImRhdGUtcGlja2VyIGRhdGUtcGlja2VyLWNvbnRhaW5lciBcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjYWxlbmRhci1jb250YWluZXJcIj5cbiAgICAgICAgPHAtY2FsZW5kYXIgIFtmaXJzdERheU9mV2Vla109XCIxXCIgIFtmb3JtQ29udHJvbF09XCJjb250cm9sXCIgW21pbkRhdGVdPVwibWluRGF0ZVwiIFttYXhEYXRlXT1cIm1heERhdGVcIiAob25Gb2N1cyk9XCJvbkNhbGVuZGFyT3BlbigpXCJcbiAgICAgICAgICAjY2FsZW5kYXIgKG9uU2VsZWN0KT1cIm9uU2VsZWN0RGF0ZSgkZXZlbnQpXCIgW3N0eWxlQ2xhc3NdPVwiZGF0ZU9wdGlvbiA9PSd3ZWVrbHknPydkYXRlLXBpY2tlci13ZWVrJyA6ICcnXCJcbiAgICAgICAgICBbdmlld109XCJkYXRlT3B0aW9uID09J21vbnRobHknPydtb250aCc6ICdkYXRlJ1wiIFtzZWxlY3Rpb25Nb2RlXT1cImRhdGVPcHRpb24gPT0nd2Vla2x5Jz8ncmFuZ2UnOidzaW5nbGUnXCJcbiAgICAgICAgICBbZGF0ZUZvcm1hdF09XCJkYXRlT3B0aW9uID09J21vbnRobHknPydtbS95eSc6ICdkZC9tbS95eSdcIiBbc2hvd1dlZWtdPVwiZGF0ZU9wdGlvbiA9PSd3ZWVrbHknXCJcbiAgICAgICAgICBbcGxhY2Vob2xkZXJdPVwiJ1NlbGVjdCBEYXRlJ1wiPjwvcC1jYWxlbmRhcj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PiJdfQ==