import { Component, EventEmitter, Input, Output } from '@angular/core';
import { ButtonModule } from 'primeng/button';
import { DialogModule } from 'primeng/dialog';
import { DragDropModule, moveItemInArray } from '@angular/cdk/drag-drop';
import { CheckboxModule } from 'primeng/checkbox';
import { FormsModule } from '@angular/forms';
import { InputTextModule } from 'primeng/inputtext';
import { MaLibModule } from '../../ma-lib.module';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
import * as i2 from "primeng/button";
import * as i3 from "@angular/forms";
import * as i4 from "primeng/dialog";
import * as i5 from "primeng/inputtext";
import * as i6 from "primeng/checkbox";
import * as i7 from "@angular/common";
import * as i8 from "../view-svg/view-svg.component";
import * as i9 from "@angular/cdk/drag-drop";
export class ConfigDisplayComponent {
    constructor(translate) {
        this.translate = translate;
        this.visible = false;
        this.colsConfig = [];
        this.selectAll = false;
        this.filterText = '';
        this.onChangeConfig = new EventEmitter();
    }
    ngOnInit() {
        this.colsConfig = this.cols.map((col) => {
            return {
                ...col,
                checked: !col.hidden,
            };
        });
    }
    get filteredColsConfig() {
        return this.colsConfig.filter((col) => col.header.toLowerCase().includes(this.filterText.toLowerCase()));
    }
    showDialog() {
        this.visible = true;
    }
    changeAll() {
        this.colsConfig.forEach((col) => {
            if (!col.fixed) {
                col.checked = this.selectAll;
            }
        });
        this.checkChangeAll();
    }
    checkChangeAll() {
        setTimeout(() => {
            const s1 = this.colsConfig.filter(col => col.checked).length;
            if (s1 === this.colsConfig.length) {
                this.selectAll = true;
            }
            else {
                this.selectAll = false;
            }
        }, 100);
    }
    drop(event) {
        this.checkChangeAll();
        if (this.colsConfig[event.currentIndex].fixed) {
            return;
        }
        moveItemInArray(this.colsConfig, event.previousIndex, event.currentIndex);
    }
    cancel() {
        this.visible = false;
    }
    apply() {
        this.visible = false;
        this.cols = this.colsConfig.map((col) => {
            return {
                ...col,
                hidden: !col.checked,
            };
        });
        this.onChangeConfig.emit(this.cols);
    }
    formatFilter() {
        const s1 = this.colsConfig.filter(col => col.checked).length;
        return s1.toString().padStart(2, '0') + '/' + this.colsConfig.length.toString().padStart(2, '0') + ' ' + this.translate.instant('selected');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: ConfigDisplayComponent, deps: [{ token: i1.TranslateService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: ConfigDisplayComponent, isStandalone: true, selector: "app-config-display", inputs: { cols: "cols" }, outputs: { onChangeConfig: "onChangeConfig" }, ngImport: i0, template: "<button pButton (click)=\"showDialog()\" type=\"button\" class=\"p-button-rounded p-button-secondary  \"\n  style=\"margin-right: 8px;\">\n  <view-svg name=\"rowHorizontal\"></view-svg>\n</button>\n<p-dialog header=\"Config\" appendTo=\"body\" [modal]=\"true\" [draggable]=\"false\" [resizable]=\"false\" [(visible)]=\"visible\"\n  [style]=\"{ width: '35rem', height: 'auto' }\">\n  <div class=\"filter-input-container\">\n    <div class=\"input-with-icon\">\n      <i class=\"pi pi-search\"></i>\n      <input type=\"text\" pInputText [(ngModel)]=\"filterText\" placeholder=\"Filter columns...\" />\n    </div>\n  </div>\n  <div class=\"config-box\">\n    <span>\n      <p-checkbox [(ngModel)]=\"selectAll\" (ngModelChange)=\"changeAll()\" [binary]=\"true\" />\n      {{'selectAll' | translate}}\n    </span>\n    <span> {{formatFilter()}}</span>\n  </div>\n  <div cdkDropList class=\"config-list\" (cdkDropListDropped)=\"drop($event)\">\n\n    <ng-container *ngFor=\"let col of filteredColsConfig\">\n      <div class=\"config-box\" [cdkDragDisabled]=\"col.fixed\" cdkDrag>\n        <span>\n          <p-checkbox (ngModelChange)=\"checkChangeAll()\" [(ngModel)]=\"col.checked\" [disabled]=\"col.fixed\"\n            [binary]=\"true\" />\n          {{col.header | translate}}\n        </span>\n        <view-svg name=\"move\"></view-svg>\n      </div>\n    </ng-container>\n  </div>\n  <div class=\"config-actions\">\n    <button pButton type=\"button\" label=\"Cancel\" class=\"p-button-secondary\" (click)=\"cancel()\"></button>\n    <button pButton type=\"button\" label=\"Apply\" class=\"p-button-primary\" (click)=\"apply()\"></button>\n  </div>\n</p-dialog>", styles: [".config-list{width:500px;max-width:100%;min-height:60px;max-height:550px;display:block;background:#fff;overflow:hidden;overflow-y:auto}.config-box{padding:10px 16px;border:solid 1px #DCDCDC;border-radius:4px;margin:4px 0;color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;cursor:move;background:#fff;font-size:14px}.config-box span{display:flex;flex-direction:row;align-items:center;gap:10px}.cdk-drag-preview{border:none;display:none;box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder{opacity:1}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.config-list.cdk-drop-list-dragging .config-box:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.config-actions{display:flex;justify-content:flex-end;gap:1rem;padding-top:16px;align-items:center}.config-actions button{min-width:80px}::ng-deep .p-dialog:has(.config-list){top:50px;position:absolute}.filter-input-container{padding-top:8px;padding-bottom:16px}.filter-input-container .input-with-icon{position:relative;display:flex;align-items:center}.filter-input-container .input-with-icon i{position:absolute;left:20px;font-size:16px;color:#6c6c6c}.filter-input-container .input-with-icon input{width:100%;padding-left:3.4rem;font-size:14px}\n"], dependencies: [{ kind: "ngmodule", type: ButtonModule }, { kind: "directive", type: i2.ButtonDirective, selector: "[pButton]", inputs: ["iconPos", "loadingIcon", "label", "icon", "loading"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i3.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "ngmodule", type: DialogModule }, { kind: "component", type: i4.Dialog, selector: "p-dialog", inputs: ["header", "draggable", "resizable", "positionLeft", "positionTop", "contentStyle", "contentStyleClass", "modal", "closeOnEscape", "dismissableMask", "rtl", "closable", "responsive", "appendTo", "breakpoints", "styleClass", "maskStyleClass", "showHeader", "breakpoint", "blockScroll", "autoZIndex", "baseZIndex", "minX", "minY", "focusOnShow", "maximizable", "keepInViewport", "focusTrap", "transitionOptions", "closeIcon", "closeAriaLabel", "closeTabindex", "minimizeIcon", "maximizeIcon", "visible", "style", "position"], outputs: ["onShow", "onHide", "visibleChange", "onResizeInit", "onResizeEnd", "onDragEnd", "onMaximize"] }, { kind: "ngmodule", type: InputTextModule }, { kind: "directive", type: i5.InputText, selector: "[pInputText]" }, { kind: "ngmodule", type: CheckboxModule }, { kind: "component", type: i6.Checkbox, selector: "p-checkbox", inputs: ["value", "name", "disabled", "binary", "label", "ariaLabelledBy", "ariaLabel", "tabindex", "inputId", "style", "styleClass", "labelStyleClass", "formControl", "checkboxIcon", "readonly", "required", "trueValue", "falseValue"], outputs: ["onChange"] }, { kind: "ngmodule", type: MaLibModule }, { kind: "directive", type: i7.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "component", type: i8.ViewSvgComponent, selector: "view-svg", inputs: ["name"] }, { kind: "pipe", type: i1.TranslatePipe, name: "translate" }, { kind: "ngmodule", type: DragDropModule }, { kind: "directive", type: i9.CdkDropList, selector: "[cdkDropList], cdk-drop-list", inputs: ["cdkDropListConnectedTo", "cdkDropListData", "cdkDropListOrientation", "id", "cdkDropListLockAxis", "cdkDropListDisabled", "cdkDropListSortingDisabled", "cdkDropListEnterPredicate", "cdkDropListSortPredicate", "cdkDropListAutoScrollDisabled", "cdkDropListAutoScrollStep"], outputs: ["cdkDropListDropped", "cdkDropListEntered", "cdkDropListExited", "cdkDropListSorted"], exportAs: ["cdkDropList"] }, { kind: "directive", type: i9.CdkDrag, selector: "[cdkDrag]", inputs: ["cdkDragData", "cdkDragLockAxis", "cdkDragRootElement", "cdkDragBoundary", "cdkDragStartDelay", "cdkDragFreeDragPosition", "cdkDragDisabled", "cdkDragConstrainPosition", "cdkDragPreviewClass", "cdkDragPreviewContainer"], outputs: ["cdkDragStarted", "cdkDragReleased", "cdkDragEnded", "cdkDragEntered", "cdkDragExited", "cdkDragDropped", "cdkDragMoved"], exportAs: ["cdkDrag"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: ConfigDisplayComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-config-display', standalone: true, imports: [ButtonModule, FormsModule, DialogModule, InputTextModule, CheckboxModule, MaLibModule, DragDropModule], template: "<button pButton (click)=\"showDialog()\" type=\"button\" class=\"p-button-rounded p-button-secondary  \"\n  style=\"margin-right: 8px;\">\n  <view-svg name=\"rowHorizontal\"></view-svg>\n</button>\n<p-dialog header=\"Config\" appendTo=\"body\" [modal]=\"true\" [draggable]=\"false\" [resizable]=\"false\" [(visible)]=\"visible\"\n  [style]=\"{ width: '35rem', height: 'auto' }\">\n  <div class=\"filter-input-container\">\n    <div class=\"input-with-icon\">\n      <i class=\"pi pi-search\"></i>\n      <input type=\"text\" pInputText [(ngModel)]=\"filterText\" placeholder=\"Filter columns...\" />\n    </div>\n  </div>\n  <div class=\"config-box\">\n    <span>\n      <p-checkbox [(ngModel)]=\"selectAll\" (ngModelChange)=\"changeAll()\" [binary]=\"true\" />\n      {{'selectAll' | translate}}\n    </span>\n    <span> {{formatFilter()}}</span>\n  </div>\n  <div cdkDropList class=\"config-list\" (cdkDropListDropped)=\"drop($event)\">\n\n    <ng-container *ngFor=\"let col of filteredColsConfig\">\n      <div class=\"config-box\" [cdkDragDisabled]=\"col.fixed\" cdkDrag>\n        <span>\n          <p-checkbox (ngModelChange)=\"checkChangeAll()\" [(ngModel)]=\"col.checked\" [disabled]=\"col.fixed\"\n            [binary]=\"true\" />\n          {{col.header | translate}}\n        </span>\n        <view-svg name=\"move\"></view-svg>\n      </div>\n    </ng-container>\n  </div>\n  <div class=\"config-actions\">\n    <button pButton type=\"button\" label=\"Cancel\" class=\"p-button-secondary\" (click)=\"cancel()\"></button>\n    <button pButton type=\"button\" label=\"Apply\" class=\"p-button-primary\" (click)=\"apply()\"></button>\n  </div>\n</p-dialog>", styles: [".config-list{width:500px;max-width:100%;min-height:60px;max-height:550px;display:block;background:#fff;overflow:hidden;overflow-y:auto}.config-box{padding:10px 16px;border:solid 1px #DCDCDC;border-radius:4px;margin:4px 0;color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;cursor:move;background:#fff;font-size:14px}.config-box span{display:flex;flex-direction:row;align-items:center;gap:10px}.cdk-drag-preview{border:none;display:none;box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder{opacity:1}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.config-list.cdk-drop-list-dragging .config-box:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.config-actions{display:flex;justify-content:flex-end;gap:1rem;padding-top:16px;align-items:center}.config-actions button{min-width:80px}::ng-deep .p-dialog:has(.config-list){top:50px;position:absolute}.filter-input-container{padding-top:8px;padding-bottom:16px}.filter-input-container .input-with-icon{position:relative;display:flex;align-items:center}.filter-input-container .input-with-icon i{position:absolute;left:20px;font-size:16px;color:#6c6c6c}.filter-input-container .input-with-icon input{width:100%;padding-left:3.4rem;font-size:14px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.TranslateService }]; }, propDecorators: { cols: [{
                type: Input
            }], onChangeConfig: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hLWxpYi9zcmMvbGliL2NvbXBvbmVudC9jb25maWcvY29uZmlnLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21hLWxpYi9zcmMvbGliL2NvbXBvbmVudC9jb25maWcvY29uZmlnLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQWUsY0FBYyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHN0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7Ozs7Ozs7Ozs7QUFRbEQsTUFBTSxPQUFPLHNCQUFzQjtJQVVqQyxZQUNVLFNBQTJCO1FBQTNCLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBUnJDLFlBQU8sR0FBWSxLQUFLLENBQUM7UUFDekIsZUFBVSxHQUFVLEVBQUUsQ0FBQztRQUN2QixjQUFTLEdBQVksS0FBSyxDQUFDO1FBQzNCLGVBQVUsR0FBVyxFQUFFLENBQUM7UUFFZCxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUFJMUMsQ0FBQztJQUVMLFFBQVE7UUFDTixJQUFJLENBQUMsVUFBVSxHQUFH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Q0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDOUksQ0FBQzsrR0F6RVUsc0JBQXNCO21HQUF0QixzQkFBc0IsdUpDakJuQyxrb0RBb0NXLCs2Q0R2QkMsWUFBWSxzS0FBRSxXQUFXLDhtQkFBRSxZQUFZLDB0QkFBRSxlQUFlLG1HQUFFLGNBQWMsbVdBQUUsV0FBVyxrVEFBRSxjQUFjOzs0RkFJcEcsc0JBQXNCO2tCQVBsQyxTQUFTOytCQUNFLG9CQUFvQixjQUNsQixJQUFJLFdBQ1AsQ0FBQyxZQUFZLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLFdBQVcsRUFBRSxjQUFjLENBQUM7dUdBS3ZHLElBQUk7c0JBQVosS0FBSztnQkFPSSxjQUFjO3NCQUF2QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJ1dHRvbk1vZHVsZSB9IGZyb20gJ3ByaW1lbmcvYnV0dG9uJztcbmltcG9ydCB7IERpYWxvZ01vZHVsZSB9IGZyb20gJ3ByaW1lbmcvZGlhbG9nJztcbmltcG9ydCB7IENka0RyYWdEcm9wLCBEcmFnRHJvcE1vZHVsZSwgbW92ZUl0ZW1JbkFycmF5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2RyYWctZHJvcCc7XG5pbXBvcnQgeyBDaGVja2JveE1vZHVsZSB9IGZyb20gJ3ByaW1lbmcvY2hlY2tib3gnO1xuaW1wb3J0IHsgRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBDb2x1bW4gfSBmcm9tICcuLi90YWJsZS90YWJsZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgSW5wdXRUZXh0TW9kdWxlIH0gZnJvbSAncHJpbWVuZy9pbnB1dHRleHQnO1xuaW1wb3J0IHsgTWFMaWJNb2R1bGUgfSBmcm9tICcuLi8uLi9tYS1saWIubW9kdWxlJztcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FwcC1jb25maWctZGlzcGxheScsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtCdXR0b25Nb2R1bGUsIEZvcm1zTW9kdWxlLCBEaWFsb2dNb2R1bGUsIElucHV0VGV4dE1vZHVsZSwgQ2hlY2tib3hNb2R1bGUsIE1hTGliTW9kdWxlLCBEcmFnRHJvcE1vZHVsZV0sXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWcuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jb25maWcuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBDb25maWdEaXNwbGF5Q29tcG9uZW50IHtcbiAgQElucHV0KCkgY29scyE6IENvbHVtbltdO1xuXG4gIHZpc2libGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgY29sc0NvbmZpZzogYW55W10gPSBbXTtcbiAgc2VsZWN0QWxsOiBib29sZWFuID0gZmFsc2U7XG4gIGZpbHRlclRleHQ6IHN0cmluZyA9ICcnO1xuXG4gIEBPdXRwdXQoKSBvbkNoYW5nZUNvbmZpZyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZVxuICApIHsgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY29sc0NvbmZpZyA9IHRoaXMuY29scy5tYXAoKGNvbCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uY29sLFxuICAgICAgICBjaGVja2VkOiAhY29sLmhpZGRlbixcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cbiAgZ2V0IGZpbHRlcmVkQ29sc0NvbmZpZygpIHtcbiAgICByZXR1cm4gdGhpcy5jb2xzQ29uZmlnLmZpbHRlcigoY29sKSA9PlxuICAgICAgY29sLmhlYWRlci50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRoaXMuZmlsdGVyVGV4dC50b0xvd2VyQ2FzZSgpKVxuICAgICk7XG4gIH1cbiAgc2hvd0RpYWxvZygpIHtcbiAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xuICB9XG4gIGNoYW5nZUFsbCgpIHtcbiAgICB0aGlzLmNvbHNDb25maWcuZm9yRWFjaCgoY29sKSA9PiB7XG4gICAgICBpZiAoIWNvbC5maXhlZCkge1xuICAgICAgICBjb2wuY2hlY2tlZCA9IHRoaXMuc2VsZWN0QWxsO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuY2hlY2tDaGFuZ2VBbGwoKTtcbiAgfVxuICBjaGVja0NoYW5nZUFsbCgpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IHMxID0gdGhpcy5jb2xzQ29uZmlnLmZpbHRlcihjb2wgPT4gY29sLmNoZWNrZWQpLmxlbmd0aDtcbiAgICAgIGlmIChzMSA9PT0gdGhpcy5jb2xzQ29uZmlnLmxlbmd0aCkge1xuICAgICAgICB0aGlzLnNlbGVjdEFsbCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNlbGVjdEFsbCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0sIDEwMCk7XG4gIH1cbiAgZHJvcChldmVudDogQ2RrRHJhZ0Ryb3A8c3RyaW5nW10+KSB7XG4gICAgdGhpcy5jaGVja0NoYW5nZUFsbCgpO1xuICAgIGlmICh0aGlzLmNvbHNDb25maWdbZXZlbnQuY3VycmVudEluZGV4XS5maXhlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBtb3ZlSXRlbUluQXJyYXkodGhpcy5jb2xzQ29uZmlnLCBldmVudC5wcmV2aW91c0luZGV4LCBldmVudC5jdXJyZW50SW5kZXgpO1xuICB9XG5cbiAgY2FuY2VsKCkge1xuICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICB9XG4gIGFwcGx5KCkge1xuICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuY29scyA9IHRoaXMuY29sc0NvbmZpZy5tYXAoKGNvbCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uY29sLFxuICAgICAgICBoaWRkZW46ICFjb2wuY2hlY2tlZCxcbiAgICAgIH07XG4gICAgfSk7XG4gICAgdGhpcy5vbkNoYW5nZUNvbmZpZy5lbWl0KHRoaXMuY29scyk7XG4gIH1cbiAgZm9ybWF0RmlsdGVyKCkge1xuICAgIGNvbnN0IHMxID0gdGhpcy5jb2xzQ29uZmlnLmZpbHRlcihjb2wgPT4gY29sLmNoZWNrZWQpLmxlbmd0aDtcblxuICAgIHJldHVybiBzMS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgKyAnLycgKyB0aGlzLmNvbHNDb25maWcubGVuZ3RoLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKSArICcgJyArIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ3NlbGVjdGVkJyk7XG4gIH1cbn1cbiIsIjxidXR0b24gcEJ1dHRvbiAoY2xpY2spPVwic2hvd0RpYWxvZygpXCIgdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwicC1idXR0b24tcm91bmRlZCBwLWJ1dHRvbi1zZWNvbmRhcnkgIFwiXG4gIHN0eWxlPVwibWFyZ2luLXJpZ2h0OiA4cHg7XCI+XG4gIDx2aWV3LXN2ZyBuYW1lPVwicm93SG9yaXpvbnRhbFwiPjwvdmlldy1zdmc+XG48L2J1dHRvbj5cbjxwLWRpYWxvZyBoZWFkZXI9XCJDb25maWdcIiBhcHBlbmRUbz1cImJvZHlcIiBbbW9kYWxdPVwidHJ1ZVwiIFtkcmFnZ2FibGVdPVwiZmFsc2VcIiBbcmVzaXphYmxlXT1cImZhbHNlXCIgWyh2aXNpYmxlKV09XCJ2aXNpYmxlXCJcbiAgW3N0eWxlXT1cInsgd2lkdGg6ICczNXJlbScsIGhlaWdodDogJ2F1dG8nIH1cIj5cbiAgPGRpdiBjbGFzcz1cImZpbHRlci1pbnB1dC1jb250YWluZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtd2l0aC1pY29uXCI+XG4gICAgICA8aSBjbGFzcz1cInBpIHBpLXNlYXJjaFwiPjwvaT5cbiAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIHBJbnB1dFRleHQgWyhuZ01vZGVsKV09XCJmaWx0ZXJUZXh0XCIgcGxhY2Vob2xkZXI9XCJGaWx0ZXIgY29sdW1ucy4uLlwiIC8+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICA8ZGl2IGNsYXNzPVwiY29uZmlnLWJveFwiPlxuICAgIDxzcGFuPlxuICAgICAgPHAtY2hlY2tib3ggWyhuZ01vZGVsKV09XCJzZWxlY3RBbGxcIiAobmdNb2RlbENoYW5nZSk9XCJjaGFuZ2VBbGwoKVwiIFtiaW5hcnldPVwidHJ1ZVwiIC8+XG4gICAgICB7eydzZWxlY3RBbGwnIHwgdHJhbnNsYXRlfX1cbiAgICA8L3NwYW4+XG4gICAgPHNwYW4+IHt7Zm9ybWF0RmlsdGVyKCl9fTwvc3Bhbj5cbiAgPC9kaXY+XG4gIDxkaXYgY2RrRHJvcExpc3QgY2xhc3M9XCJjb25maWctbGlzdFwiIChjZGtEcm9wTGlzdERyb3BwZWQpPVwiZHJvcCgkZXZlbnQpXCI+XG5cbiAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBjb2wgb2YgZmlsdGVyZWRDb2xzQ29uZmlnXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY29uZmlnLWJveFwiIFtjZGtEcmFnRGlzYWJsZWRdPVwiY29sLmZpeGVkXCIgY2RrRHJhZz5cbiAgICAgICAgPHNwYW4+XG4gICAgICAgICAgPHAtY2hlY2tib3ggKG5nTW9kZWxDaGFuZ2UpPVwiY2hlY2tDaGFuZ2VBbGwoKVwiIFsobmdNb2RlbCldPVwiY29sLmNoZWNrZWRcIiBbZGlzYWJsZWRdPVwiY29sLmZpeGVkXCJcbiAgICAgICAgICAgIFtiaW5hcnldPVwidHJ1ZVwiIC8+XG4gICAgICAgICAge3tjb2wuaGVhZGVyIHwgdHJhbnNsYXRlfX1cbiAgICAgICAgPC9zcGFuPlxuICAgICAgICA8dmlldy1zdmcgbmFtZT1cIm1vdmVcIj48L3ZpZXctc3ZnPlxuICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvZGl2PlxuICA8ZGl2IGNsYXNzPVwiY29uZmlnLWFjdGlvbnNcIj5cbiAgICA8YnV0dG9uIHBCdXR0b24gdHlwZT1cImJ1dHRvblwiIGxhYmVsPVwiQ2FuY2VsXCIgY2xhc3M9XCJwLWJ1dHRvbi1zZWNvbmRhcnlcIiAoY2xpY2spPVwiY2FuY2VsKClcIj48L2J1dHRvbj5cbiAgICA8YnV0dG9uIHBCdXR0b24gdHlwZT1cImJ1dHRvblwiIGxhYmVsPVwiQXBwbHlcIiBjbGFzcz1cInAtYnV0dG9uLXByaW1hcnlcIiAoY2xpY2spPVwiYXBwbHkoKVwiPjwvYnV0dG9uPlxuICA8L2Rpdj5cbjwvcC1kaWFsb2c+Il19